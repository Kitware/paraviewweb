<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8">
  <title>MutualInformationDiagram | ParaViewWeb</title>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Canonical links -->
  <link rel="canonical" href="https://kitware.github.io/paraviewweb/api/MutualInformationDiagram.html">
  <!-- Alternative links -->
  
    
      <link rel="alternative" hreflang="en" href="https://kitware.github.io/paraviewweb/api/MutualInformationDiagram.html">
    
  
  <!-- Icon -->
  <link rel="apple-touch-icon" sizes="57x57" href="/paraviewweb/icon/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/paraviewweb/icon/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/paraviewweb/icon/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/paraviewweb/icon/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/paraviewweb/icon/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/paraviewweb/icon/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/paraviewweb/icon/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/paraviewweb/icon/apple-touch-icon-152x152.png">
  <link rel="icon" type="image/png" href="/paraviewweb/icon/favicon-196x196.png" sizes="196x196">
  <link rel="icon" type="image/png" href="/paraviewweb/icon/favicon-160x160.png" sizes="160x160">
  <link rel="icon" type="image/png" href="/paraviewweb/icon/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/paraviewweb/icon/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/paraviewweb/icon/favicon-32x32.png" sizes="32x32">
  <meta name="msapplication-TileColor" content="#2f83cd">
  <meta name="msapplication-TileImage" content="/paraviewweb/icon/mstile-144x144.png">
  <!-- CSS -->
  <!-- build:css build/css/navy.css -->
  <link rel="stylesheet" href="/paraviewweb/css/navy.css">
  <!-- endbuild -->
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css">
  <!-- RSS -->
  <link rel="alternate" href="/paraviewweb/atom.xml" title="ParaViewWeb">
  <!-- Open Graph -->
  <meta name="description" content="Sourcebody.html&amp;lt;div class=&quot;info-diagram-container&quot;&amp;gt;  &amp;lt;div class=&quot;info-diagram-placeholder&quot;&amp;gt;    &amp;lt;div class=&quot;id-placeholder-row&quot;&amp;gt;      &amp;lt;span class=&quot;id-placeholder-title&quot;&amp;gt;Informat">
<meta property="og:type" content="website">
<meta property="og:title" content="MutualInformationDiagram">
<meta property="og:url" content="https://kitware.github.io/paraviewweb/api/MutualInformationDiagram.html">
<meta property="og:site_name" content="ParaViewWeb">
<meta property="og:description" content="Sourcebody.html&amp;lt;div class=&quot;info-diagram-container&quot;&amp;gt;  &amp;lt;div class=&quot;info-diagram-placeholder&quot;&amp;gt;    &amp;lt;div class=&quot;id-placeholder-row&quot;&amp;gt;      &amp;lt;span class=&quot;id-placeholder-title&quot;&amp;gt;Informat">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2018-01-04T16:45:40.804Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MutualInformationDiagram">
<meta name="twitter:description" content="Sourcebody.html&amp;lt;div class=&quot;info-diagram-container&quot;&amp;gt;  &amp;lt;div class=&quot;info-diagram-placeholder&quot;&amp;gt;    &amp;lt;div class=&quot;id-placeholder-row&quot;&amp;gt;      &amp;lt;span class=&quot;id-placeholder-title&quot;&amp;gt;Informat">
  <!-- Google Analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-90338862-2', 'auto');
  ga('send', 'pageview');
</script>

</head>

<body>
  <div id="container">
    <header id="header" class="wrapper">
  <div id="header-inner" class="inner">
    <h1 id="logo-wrap">
      <a href="/paraviewweb/" id="logo">ParaViewWeb</a>
    </h1>
    <nav id="main-nav">
      <a href="/paraviewweb/docs/" class="main-nav-link">Docs</a><a href="/paraviewweb/api/" class="main-nav-link">API</a><a href="/paraviewweb/examples/" class="main-nav-link">Examples</a><a href="/paraviewweb/applications/" class="main-nav-link">Applications</a>
      <a href="https://github.com/kitware/paraviewweb" class="main-nav-link"><i class="fa fa-github-alt"></i></a>
      <div id="search-input-wrap">
        <div id="search-input-icon">
          <i class="fa fa-search"></i>
        </div>
        <input type="search" id="search-input" placeholder="Search...">
      </div>
    </nav>
    <a id="mobile-nav-toggle">
      <span class="mobile-nav-toggle-bar"></span>
      <span class="mobile-nav-toggle-bar"></span>
      <span class="mobile-nav-toggle-bar"></span>
    </a>
  </div>
</header>

    <div id="content-wrap">
  <div id="content" class="wrapper">
    <div id="content-inner">
      <article class="article-container" itemscope itemtype="http://schema.org/Article">
        <div class="article-inner">
          <div class="article">
            <div class="inner">
              <header class="article-header">
                <h1 class="article-title" itemprop="name">MutualInformationDiagram</h1>
              </header>
              <div class="article-content" itemprop="articleBody">
                <h1 id="Source" class="article-heading"><a href="#Source" class="headerlink" title="Source"></a>Source<a class="article-anchor" href="#Source" aria-hidden="true"></a></h1><figure class="highlight js"><figcaption><span>body.html</span></figcaption><table><tr><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"info-diagram-container"</span>&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"info-diagram-placeholder"</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"id-placeholder-row"</span>&gt;</span><br><span class="line">      &lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">"id-placeholder-title"</span>&gt;Information Diagram&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"id-placeholder-row"</span>&gt;</span><br><span class="line">      &lt;img <span class="class"><span class="keyword">class</span></span>=<span class="string">"id-placeholder-image"</span>/&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;div class="id-placeholder-row"&gt;</span></span><br><span class="line"><span class="regexp">      &lt;span class="id-placeholder-info"&gt;Please select two or more variables&lt;/</span>span&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"status-bar-container"</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"status-bar"</span>&gt;</span><br><span class="line">      &lt;i <span class="class"><span class="keyword">class</span></span>=<span class="string">"show-button"</span>&gt;&lt;/i&gt;</span><br><span class="line">      &lt;i <span class="class"><span class="keyword">class</span></span>=<span class="string">"hide-button"</span>&gt;&lt;/i&gt;</span><br><span class="line">      &lt;input type=<span class="string">"text"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"status-bar-text"</span> readonly=<span class="string">"true"</span> /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>index.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">/* global document */</span></span><br><span class="line"><span class="keyword">import</span> d3 <span class="keyword">from</span> <span class="string">'d3'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">'PVWStyle/InfoVizNative/InformationDiagram.mcss'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> CompositeClosureHelper <span class="keyword">from</span> <span class="string">'../../../Common/Core/CompositeClosureHelper'</span>;</span><br><span class="line"><span class="keyword">import</span> htmlContent <span class="keyword">from</span> <span class="string">'./body.html'</span>;</span><br><span class="line"><span class="keyword">import</span> iconImage <span class="keyword">from</span> <span class="string">'./InfoDiagramIconSmall.png'</span>;</span><br><span class="line"><span class="comment">// import multiClicker from '../../Core/D3MultiClick';</span></span><br><span class="line"><span class="keyword">import</span> SelectionBuilder <span class="keyword">from</span> <span class="string">'../../../Common/Misc/SelectionBuilder'</span>;</span><br><span class="line"><span class="keyword">import</span> AnnotationBuilder <span class="keyword">from</span> <span class="string">'../../../Common/Misc/AnnotationBuilder'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  calculateAngleAndRadius,</span><br><span class="line">  downsample,</span><br><span class="line">  freqToProb,</span><br><span class="line">  topBinPmi,</span><br><span class="line">  topPmi,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'./utils'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PMI_CHORD_MODE_NONE = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> PMI_CHORD_MODE_ONE_BIN_ALL_VARS = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> PMI_CHORD_MODE_ALL_BINS_TWO_VARS = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> miCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* eslint-disable no-use-before-define */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// Information Diagram</span></span><br><span class="line"><span class="comment">// ----------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">informationDiagram</span>(<span class="params">publicAPI, model</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> lastAnnotationPushed = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!model.provider</span><br><span class="line">    || !model.provider.isA(<span class="string">'MutualInformationProvider'</span>)</span><br><span class="line">    || !model.provider.isA(<span class="string">'Histogram1DProvider'</span>)</span><br><span class="line">    || !model.provider.isA(<span class="string">'FieldProvider'</span>)) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Invalid provider:'</span>, model.provider);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  model.renderState = &#123;</span><br><span class="line">    pmiAllBinsTwoVars: <span class="literal">null</span>,</span><br><span class="line">    pmiOneBinAllVars: <span class="literal">null</span>,</span><br><span class="line">    pmiHighlight: <span class="literal">null</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  model.clientRect = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  miCount += <span class="number">1</span>;</span><br><span class="line">  <span class="comment">// unique id, based on count</span></span><br><span class="line">  model.instanceID = <span class="string">`pvwInformationDiagram-<span class="subst">$&#123;miCount&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Handle style for status bar</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">updateStatusBarVisibility</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> cntnr = d3.select(model.container);</span><br><span class="line">    <span class="keyword">if</span> (model.statusBarVisible) &#123;</span><br><span class="line">      cntnr.select(<span class="string">'.status-bar-container'</span>)</span><br><span class="line">        .style(<span class="string">'width'</span>, <span class="function"><span class="keyword">function</span> <span class="title">updateWidth</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.dataset.width; &#125;);</span><br><span class="line">      cntnr.select(<span class="string">'.show-button'</span>).classed(style.hidden, <span class="literal">true</span>);</span><br><span class="line">      cntnr.select(<span class="string">'.hide-button'</span>).classed(style.hidden, <span class="literal">false</span>);</span><br><span class="line">      cntnr.select(<span class="string">'.status-bar-text'</span>).classed(style.hidden, <span class="literal">false</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      cntnr.select(<span class="string">'.status-bar-container'</span>).style(<span class="string">'width'</span>, <span class="string">'20px'</span>);</span><br><span class="line">      cntnr.select(<span class="string">'.show-button'</span>).classed(style.hidden, <span class="literal">false</span>);</span><br><span class="line">      cntnr.select(<span class="string">'.hide-button'</span>).classed(style.hidden, <span class="literal">true</span>);</span><br><span class="line">      cntnr.select(<span class="string">'.status-bar-text'</span>).classed(style.hidden, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  publicAPI.propagateAnnotationInsteadOfSelection = <span class="function">(<span class="params">useAnnotation = <span class="literal">true</span>, defaultScore = <span class="number">0</span>, defaultWeight = <span class="number">0</span></span>) =&gt;</span> &#123;</span><br><span class="line">    model.useAnnotation = useAnnotation;</span><br><span class="line">    model.defaultScore = defaultScore;</span><br><span class="line">    model.defaultWeight = defaultWeight;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  publicAPI.resize = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!model.container) &#123;</span><br><span class="line">      <span class="keyword">return</span>; <span class="comment">// no shirt, no shoes, no service.</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    model.clientRect = model.container.getBoundingClientRect();</span><br><span class="line"></span><br><span class="line">    d3.select(model.container)</span><br><span class="line">      .select(<span class="string">'div.status-bar-container'</span>)</span><br><span class="line">      .attr(<span class="string">'data-width'</span>, <span class="string">`<span class="subst">$&#123;model.clientRect.width - <span class="number">20</span>&#125;</span>px`</span>);</span><br><span class="line"></span><br><span class="line">    publicAPI.render();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  publicAPI.setContainer = <span class="function">(<span class="params">el</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (model.container) &#123;</span><br><span class="line">      <span class="keyword">while</span> (model.container.firstChild) &#123;</span><br><span class="line">        model.container.removeChild(model.container.firstChild);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    model.container = el;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (model.container) &#123;</span><br><span class="line">      <span class="comment">// Create placeholder</span></span><br><span class="line">      model.container.innerHTML = htmlContent;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Apply style</span></span><br><span class="line">      <span class="keyword">const</span> d3Container = d3</span><br><span class="line">        .select(model.container)</span><br><span class="line">        .select(<span class="string">'.info-diagram-container'</span>)</span><br><span class="line">        .classed(style.infoDiagramContainer, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">      d3Container</span><br><span class="line">        .select(<span class="string">'.status-bar-container'</span>)</span><br><span class="line">        .classed(style.statusBarContainer, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">      d3Container</span><br><span class="line">        .select(<span class="string">'.status-bar-text'</span>)</span><br><span class="line">        .classed(style.statusBarText, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">      d3Container</span><br><span class="line">        .select(<span class="string">'.show-button'</span>)</span><br><span class="line">        .classed(style.showButton, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">      d3Container</span><br><span class="line">        .select(<span class="string">'.hide-button'</span>)</span><br><span class="line">        .classed(style.hideButton, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">      d3Container</span><br><span class="line">        .select(<span class="string">'.info-diagram-placeholder'</span>)</span><br><span class="line">        .classed(style.infoDiagramPlaceholder, <span class="literal">true</span>)</span><br><span class="line">        .select(<span class="string">'img'</span>)</span><br><span class="line">        .attr(<span class="string">'src'</span>, iconImage);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Attach listener for show/hide status bar</span></span><br><span class="line">      d3Container.selectAll(<span class="string">'.show-button, .hide-button'</span>).on(<span class="string">'click'</span>, () =&gt; &#123;</span><br><span class="line">        model.statusBarVisible = !model.statusBarVisible;</span><br><span class="line">        updateStatusBarVisibility();</span><br><span class="line">        d3.event.preventDefault();</span><br><span class="line">        d3.event.stopPropagation();</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      updateStatusBarVisibility();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  publicAPI.updateStatusBarText = <span class="function"><span class="params">msg</span> =&gt;</span> d3.select(model.container).select(<span class="string">'input.status-bar-text'</span>).attr(<span class="string">'value'</span>, msg);</span><br><span class="line"></span><br><span class="line">  publicAPI.selectStatusBarText = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// select text so user can press ctrl-c if desired.</span></span><br><span class="line">    <span class="keyword">if</span> (model.statusBarVisible) &#123;</span><br><span class="line">      <span class="comment">// https://www.sitepoint.com/javascript-copy-to-clipboard/</span></span><br><span class="line">      d3.select(model.container).select(<span class="string">'input.status-bar-text'</span>).node().select();</span><br><span class="line">      <span class="comment">// Copy-to-clipboard works because status bar text is an 'input':</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">document</span>.execCommand(<span class="string">'copy'</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Copy to clipboard failed. Press Ctrl-C to copy'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// track chord mode between renders</span></span><br><span class="line">  <span class="keyword">const</span> pmiChordMode = &#123;</span><br><span class="line">    mode: PMI_CHORD_MODE_NONE,</span><br><span class="line">    srcParam: <span class="literal">null</span>,</span><br><span class="line">    srcBin: <span class="literal">null</span>,</span><br><span class="line">    miIndex: <span class="number">-1</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  publicAPI.render = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Extract provider data for local access</span></span><br><span class="line">    <span class="keyword">const</span> getLegend = model.provider.isA(<span class="string">'LegendProvider'</span>) ? model.provider.getLegend : <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">const</span> histogram1DnumberOfBins = model.numberOfBins;</span><br><span class="line">    <span class="keyword">const</span> variableList = model.provider.getActiveFieldNames();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (variableList.length &lt; <span class="number">2</span> || !model.container) &#123;</span><br><span class="line">      <span class="comment">// Select the main circle and hide it and unhide placeholder</span></span><br><span class="line">      d3.select(model.container).select(<span class="string">'svg.information-diagram'</span>)</span><br><span class="line">        .classed(style.informationDiagramSvgShow, <span class="literal">false</span>)</span><br><span class="line">        .classed(style.informationDiagramSvgHide, <span class="literal">true</span>);</span><br><span class="line">      d3.select(model.container).select(<span class="string">'div.info-diagram-placeholder'</span>).classed(style.hidden, <span class="literal">false</span>);</span><br><span class="line">      publicAPI.updateStatusBarText(<span class="string">''</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Guard against rendering if container is non-null but has no size (as</span></span><br><span class="line">    <span class="comment">// in the case when workbench layout doesn't include our container)</span></span><br><span class="line">    <span class="keyword">if</span> (model.clientRect === <span class="literal">null</span> || model.clientRect.width === <span class="number">0</span> || model.clientRect.height === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> width = model.clientRect.width;</span><br><span class="line">    <span class="keyword">const</span> height = model.clientRect.height;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Make sure we have all the data we need</span></span><br><span class="line">    <span class="keyword">if</span> (!model.mutualInformationData || !model.histogramData) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update</span></span><br><span class="line">    updateStatusBarVisibility();</span><br><span class="line"></span><br><span class="line">    d3.select(model.container).select(<span class="string">'div.info-diagram-placeholder'</span>).classed(style.hidden, <span class="literal">true</span>);</span><br><span class="line">    d3.select(model.container).select(<span class="string">'svg.information-diagram'</span>)</span><br><span class="line">      .classed(style.informationDiagramSvgHide, <span class="literal">false</span>)</span><br><span class="line">      .classed(style.informationDiagramSvgShow, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> outerHistoRadius = <span class="built_in">Math</span>.min(width, height) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">const</span> veryOutermostRadius = outerHistoRadius + <span class="number">80</span>;</span><br><span class="line">    <span class="keyword">const</span> histoRadius = outerHistoRadius - <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">const</span> outerRadius = histoRadius - <span class="number">50</span>;</span><br><span class="line">    <span class="keyword">const</span> innerRadius = outerRadius - <span class="number">24</span>;</span><br><span class="line">    <span class="keyword">const</span> deltaRadius = outerRadius - innerRadius;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> formatPercent = d3.format(<span class="string">'.1%'</span>);</span><br><span class="line">    <span class="keyword">const</span> formatMI = d3.format(<span class="string">'.2f'</span>);</span><br><span class="line">    <span class="keyword">const</span> formatVal = d3.format(<span class="string">'.2s'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> arc = d3.svg.arc()</span><br><span class="line">      .innerRadius(innerRadius)</span><br><span class="line">      .outerRadius(outerRadius);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> histoArc = d3.svg.arc().innerRadius(outerRadius + <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> insideArc = d3.svg.arc()</span><br><span class="line">      .innerRadius(<span class="number">1</span>)</span><br><span class="line">      .outerRadius(innerRadius);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> layout = d3</span><br><span class="line">      .layout</span><br><span class="line">      .chord()</span><br><span class="line">      .padding(<span class="number">0.04</span>)</span><br><span class="line">      .sortSubgroups(d3.descending)</span><br><span class="line">      .sortChords(d3.ascending);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> path = d3.svg.chord().radius(innerRadius);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> svgParent = d3.select(model.container).select(<span class="string">'svg'</span>);</span><br><span class="line">    <span class="keyword">let</span> svg = svgParent.select(<span class="string">'.main-circle'</span>);</span><br><span class="line">    <span class="keyword">if</span> (svgParent.empty()) &#123;</span><br><span class="line">      svgParent = d3.select(model.container).append(<span class="string">'svg'</span>)</span><br><span class="line">      .style(<span class="string">'float'</span>, <span class="string">'left'</span>)</span><br><span class="line">      .attr(<span class="string">'class'</span>, style.informationDiagramSvgShow)</span><br><span class="line">      .classed(<span class="string">'information-diagram'</span>, <span class="literal">true</span>);</span><br><span class="line">      svg = svgParent.append(<span class="string">'g'</span>)</span><br><span class="line">      .classed(<span class="string">'main-circle'</span>, <span class="literal">true</span>)</span><br><span class="line">      .classed(style.mainCircle, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    svgParent</span><br><span class="line">      .attr(<span class="string">'width'</span>, width)</span><br><span class="line">      .attr(<span class="string">'height'</span>, height);</span><br><span class="line">    svg</span><br><span class="line">      .attr(<span class="string">'transform'</span>, <span class="string">`translate(<span class="subst">$&#123;width <span class="regexp">/ 2&#125;, $&#123;height /</span> <span class="number">2</span>&#125;</span>)`</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">findGroupAndBin</span>(<span class="params">relCoords</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">const</span> result = &#123;</span><br><span class="line">        found: <span class="literal">false</span>,</span><br><span class="line">        group: <span class="literal">null</span>,</span><br><span class="line">        bin: <span class="number">-1</span>,</span><br><span class="line">        radius: <span class="number">0</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">const</span> [angle, radius] = calculateAngleAndRadius(relCoords, [width, height]);</span><br><span class="line">      result.radius = radius;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> groupIdx = <span class="number">0</span>; groupIdx &lt; layout.groups().length; ++groupIdx) &#123;</span><br><span class="line">        <span class="keyword">const</span> groupData = layout.groups()[groupIdx];</span><br><span class="line">        <span class="keyword">const</span> groupName = model.mutualInformationData.vmap[groupData.index].name;</span><br><span class="line">        <span class="keyword">if</span> (angle &gt; groupData.startAngle &amp;&amp; angle &lt;= groupData.endAngle) &#123;</span><br><span class="line">          <span class="keyword">const</span> binSizeRadians = (groupData.endAngle - groupData.startAngle) / model.numberOfBins;</span><br><span class="line">          <span class="keyword">const</span> binIndex = <span class="built_in">Math</span>.floor((angle - groupData.startAngle) / binSizeRadians);</span><br><span class="line">          result.found = <span class="literal">true</span>;</span><br><span class="line">          result.group = groupName;</span><br><span class="line">          result.bin = binIndex;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">unHoverBin</span>(<span class="params">param</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (model.provider.isA(<span class="string">'HistogramBinHoverProvider'</span>)) &#123;</span><br><span class="line">        <span class="keyword">const</span> state = &#123;&#125;;</span><br><span class="line">        state[param] = [<span class="number">-1</span>];</span><br><span class="line">        model.provider.setHoverState(&#123;</span><br><span class="line">          source: <span class="string">'MutualInformationDiagram'</span>,</span><br><span class="line">          state,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">hoverBins</span>(<span class="params">binMap</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (model.provider.isA(<span class="string">'HistogramBinHoverProvider'</span>)) &#123;</span><br><span class="line">        model.provider.setHoverState(&#123;</span><br><span class="line">          source: <span class="string">'MutualInformationDiagram'</span>,</span><br><span class="line">          state: binMap,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">updateActiveSelection</span>(<span class="params">binMap</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!model.provider.isA(<span class="string">'SelectionProvider'</span>) || !model.provider.isA(<span class="string">'FieldProvider'</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> vars = &#123;&#125;;</span><br><span class="line">      <span class="keyword">let</span> proceed = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">Object</span>.keys(binMap).forEach(<span class="function">(<span class="params">pName</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> paramRange = model.provider.getField(pName).range;</span><br><span class="line">        <span class="keyword">const</span> binList = binMap[pName];</span><br><span class="line">        <span class="keyword">const</span> rangeList = [];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; binList.length; ++i) &#123;</span><br><span class="line">          <span class="keyword">if</span> (binList[i] !== <span class="number">-1</span>) &#123;</span><br><span class="line">            rangeList.push(&#123;</span><br><span class="line">              interval: getBinRange(binList[i], histogram1DnumberOfBins, [paramRange[<span class="number">0</span>], paramRange[<span class="number">1</span>], paramRange[<span class="number">1</span>] - paramRange[<span class="number">0</span>]]),</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (rangeList.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          proceed = <span class="literal">true</span>;</span><br><span class="line">          vars[pName] = rangeList;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (proceed) &#123;</span><br><span class="line">        <span class="keyword">const</span> selection = SelectionBuilder.range(vars);</span><br><span class="line">        <span class="keyword">if</span> (model.useAnnotation) &#123;</span><br><span class="line">          lastAnnotationPushed = model.provider.getAnnotation();</span><br><span class="line">          <span class="keyword">if</span> (!lastAnnotationPushed || model.provider.shouldCreateNewAnnotation() || lastAnnotationPushed.selection.type !== <span class="string">'range'</span>) &#123;</span><br><span class="line">            lastAnnotationPushed = AnnotationBuilder.annotation(selection, [model.defaultScore], model.defaultWeight);</span><br><span class="line">            <span class="keyword">if</span> (lastAnnotationPushed.name === <span class="string">''</span>) &#123;</span><br><span class="line">              <span class="comment">// set default range annotation name</span></span><br><span class="line">              AnnotationBuilder.setDefaultName(lastAnnotationPushed);</span><br><span class="line">              <span class="keyword">if</span> (model.provider.isA(<span class="string">'AnnotationStoreProvider'</span>)) &#123;</span><br><span class="line">                lastAnnotationPushed.name = model.provider.getNextStoredAnnotationName(lastAnnotationPushed.name);</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            lastAnnotationPushed = AnnotationBuilder.update(lastAnnotationPushed, &#123;</span><br><span class="line">              selection,</span><br><span class="line">              score: [model.defaultScore],</span><br><span class="line">              weight: model.defaultWeight,</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">          AnnotationBuilder.updateReadOnlyFlag(lastAnnotationPushed, model.readOnlyFields);</span><br><span class="line">          model.provider.setAnnotation(lastAnnotationPushed);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          model.provider.setSelection(selection);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// function findPmiChordsToHighlight(param, bin, highlight = true, oneBinAllVarsMode = false) &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">findPmiChordsToHighlight</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">group</span>: param, bin, highlight, <span class="attr">mode</span>: oneBinAllVarsMode &#125; = model.renderState.pmiHighlight;</span><br><span class="line">      <span class="keyword">if</span> (highlight) &#123;</span><br><span class="line">        svg.select(<span class="string">'g.pmiChords'</span>)</span><br><span class="line">          .selectAll(<span class="string">'path.pmiChord'</span>)</span><br><span class="line">          .classed(<span class="string">'highlight-pmi'</span>, <span class="literal">false</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> binMap = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">addBin</span>(<span class="params">pName, bIdx</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!binMap[pName]) &#123;</span><br><span class="line">          binMap[pName] = [];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (binMap[pName].indexOf(bIdx) === <span class="number">-1</span>) &#123;</span><br><span class="line">          binMap[pName].push(bIdx);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (oneBinAllVarsMode) &#123;</span><br><span class="line">        svg.select(<span class="string">'g.pmiChords'</span>).selectAll(<span class="string">`path[data-source-name="<span class="subst">$&#123;param&#125;</span>"]:not(.fade)`</span>)</span><br><span class="line">          .classed(<span class="string">'highlight-pmi'</span>, highlight)</span><br><span class="line">          .each(<span class="function"><span class="keyword">function</span> <span class="title">highlightPMI</span>(<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">const</span> elt = d3.select(<span class="keyword">this</span>);</span><br><span class="line">            addBin(param, bin);</span><br><span class="line">            addBin(elt.attr(<span class="string">'data-target-name'</span>), <span class="built_in">Number</span>.parseInt(elt.attr(<span class="string">'data-target-bin'</span>), <span class="number">10</span>));</span><br><span class="line">          &#125;);</span><br><span class="line"></span><br><span class="line">        svg.select(<span class="string">'g.pmiChords'</span>)</span><br><span class="line">          .selectAll(<span class="string">`path[data-target-name="<span class="subst">$&#123;param&#125;</span>"]:not(.fade)`</span>)</span><br><span class="line">          .each(<span class="function"><span class="keyword">function</span> <span class="title">inner</span>(<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">const</span> elt = d3.select(<span class="keyword">this</span>);</span><br><span class="line">            addBin(param, <span class="built_in">Number</span>.parseInt(elt.attr(<span class="string">'data-target-bin'</span>), <span class="number">10</span>));</span><br><span class="line">            addBin(elt.attr(<span class="string">'data-source-name'</span>), <span class="built_in">Number</span>.parseInt(elt.attr(<span class="string">'data-source-bin'</span>), <span class="number">10</span>));</span><br><span class="line">          &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (binMap[param] &amp;&amp; binMap[param].indexOf(bin) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">          binMap[param] = [bin];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        svg.select(<span class="string">'g.pmiChords'</span>).selectAll(<span class="string">`path[data-target-name="<span class="subst">$&#123;param&#125;</span>"]:not(.fade)`</span>)</span><br><span class="line">          .classed(<span class="string">'highlight-pmi'</span>, <span class="function"><span class="keyword">function</span> <span class="title">inner</span>(<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">const</span> elt = d3.select(<span class="keyword">this</span>);</span><br><span class="line">            <span class="keyword">return</span> binMap[param].indexOf(<span class="built_in">Number</span>.parseInt(elt.attr(<span class="string">'data-target-bin'</span>), <span class="number">10</span>)) &gt;= <span class="number">0</span>;</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        svg.select(<span class="string">'g.pmiChords'</span>).selectAll(<span class="string">`path[data-source-name="<span class="subst">$&#123;param&#125;</span>"][data-source-bin="<span class="subst">$&#123;bin&#125;</span>"]:not(.fade)`</span>)</span><br><span class="line">        .classed(<span class="string">'highlight-pmi'</span>, highlight)</span><br><span class="line">        .each(<span class="function"><span class="keyword">function</span> <span class="title">highlightPMI</span>(<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">const</span> elt = d3.select(<span class="keyword">this</span>);</span><br><span class="line">          addBin(param, bin);</span><br><span class="line">          addBin(elt.attr(<span class="string">'data-target-name'</span>), <span class="built_in">Number</span>.parseInt(elt.attr(<span class="string">'data-target-bin'</span>), <span class="number">10</span>));</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        svg.select(<span class="string">'g.pmiChords'</span>).selectAll(<span class="string">`path[data-target-name="<span class="subst">$&#123;param&#125;</span>"][data-target-bin="<span class="subst">$&#123;bin&#125;</span>"]:not(.fade)`</span>)</span><br><span class="line">          .classed(<span class="string">'highlight-pmi'</span>, highlight)</span><br><span class="line">          .each(<span class="function"><span class="keyword">function</span> <span class="title">highlightPMI</span>(<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">const</span> elt = d3.select(<span class="keyword">this</span>);</span><br><span class="line">            addBin(param, bin);</span><br><span class="line">            addBin(elt.attr(<span class="string">'data-source-name'</span>), <span class="built_in">Number</span>.parseInt(elt.attr(<span class="string">'data-source-bin'</span>), <span class="number">10</span>));</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> binMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Chord handling ---------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">updateChordVisibility</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (options.mi &amp;&amp; options.mi.show === <span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (options.mi.index !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">          chord.classed(<span class="string">'fade'</span>, p =&gt; p.source.index !== options.mi.index &amp;&amp; p.target.index !== options.mi.index);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          chord.classed(<span class="string">'fade'</span>, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        svg.selectAll(<span class="string">'g.pmiChords path.pmiChord'</span>).classed(<span class="string">'fade'</span>, <span class="literal">true</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (options.pmi &amp;&amp; options.pmi.show === <span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="comment">// Currently drawing pmi chords fades all mi chords, so we</span></span><br><span class="line">        <span class="comment">// don't have to do anything here to keep things consistent.</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">drawPMIAllBinsTwoVars</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">const</span> d = model.renderState.pmiAllBinsTwoVars.d;</span><br><span class="line">      <span class="keyword">if</span> (d.source.index === d.target.index) &#123;</span><br><span class="line">        <span class="comment">// console.log('Cannot render self-PMI', model.mutualInformationData.vmap[d.source.index].name);</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      pmiChordMode.mode = PMI_CHORD_MODE_ALL_BINS_TWO_VARS;</span><br><span class="line">      pmiChordMode.srcParam = <span class="literal">null</span>;</span><br><span class="line">      pmiChordMode.srcBin = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Turn off MI rendering</span></span><br><span class="line">      chord.classed(<span class="string">'fade'</span>, <span class="literal">true</span>);</span><br><span class="line">      <span class="comment">// Turn on PMI rendering</span></span><br><span class="line">      <span class="keyword">let</span> va = model.mutualInformationData.vmap[d.source.index].name;</span><br><span class="line">      <span class="keyword">let</span> vb = model.mutualInformationData.vmap[d.target.index].name;</span><br><span class="line">      <span class="keyword">let</span> swap = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">if</span> (vb &lt; va) &#123;</span><br><span class="line">        <span class="keyword">const</span> tmp = vb;</span><br><span class="line">        vb = va;</span><br><span class="line">        va = tmp;</span><br><span class="line">        swap = <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> cAB = downsample(model.mutualInformationData.joint[va][vb], histogram1DnumberOfBins, swap);</span><br><span class="line">      <span class="keyword">const</span> probDict = freqToProb(cAB);</span><br><span class="line">      <span class="keyword">const</span> linksToDraw = topPmi(probDict, <span class="number">0.95</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Make mutual info chords invisible.</span></span><br><span class="line">      svg.selectAll(<span class="string">'g.group path.chord'</span>)</span><br><span class="line">        .classed(<span class="string">'fade'</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> linkData = svg.select(<span class="string">'g.pmiChords'</span>)</span><br><span class="line">        .selectAll(<span class="string">'path.pmiChord'</span>)</span><br><span class="line">        .data(d3.zip(linksToDraw.idx, linksToDraw.pmi,</span><br><span class="line">          <span class="keyword">new</span> <span class="built_in">Array</span>(linksToDraw.idx.length).fill([va, vb])));</span><br><span class="line"></span><br><span class="line">      linkData</span><br><span class="line">        .enter()</span><br><span class="line">        .append(<span class="string">'path'</span>)</span><br><span class="line">        .classed(<span class="string">'pmiChord'</span>, <span class="literal">true</span>)</span><br><span class="line">        .classed(style.pmiChord, <span class="literal">true</span>);</span><br><span class="line">      linkData.exit().remove();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> vaGroup = layout.groups()[d.source.index];</span><br><span class="line">      <span class="keyword">const</span> vbGroup = layout.groups()[d.target.index];</span><br><span class="line">      <span class="keyword">const</span> vaRange = [vaGroup.startAngle, (vaGroup.endAngle - vaGroup.startAngle), (vaGroup.endAngle - vaGroup.startAngle) / histogram1DnumberOfBins];</span><br><span class="line">      <span class="keyword">const</span> vbRange = [vbGroup.startAngle, (vbGroup.endAngle - vbGroup.startAngle), (vbGroup.endAngle - vbGroup.startAngle) / histogram1DnumberOfBins];</span><br><span class="line"></span><br><span class="line">      linkData</span><br><span class="line">        .classed(<span class="string">'fade'</span>, <span class="literal">false</span>)</span><br><span class="line">        .attr(<span class="string">'d'</span>, (data, index) =&gt;</span><br><span class="line">          path(&#123;</span><br><span class="line">            source: &#123;</span><br><span class="line">              startAngle: (vaRange[<span class="number">0</span>] + (data[<span class="number">0</span>][<span class="number">0</span>] * vaRange[<span class="number">2</span>])),</span><br><span class="line">              endAngle: (vaRange[<span class="number">0</span>] + ((data[<span class="number">0</span>][<span class="number">0</span>] + <span class="number">1</span>) * vaRange[<span class="number">2</span>])),</span><br><span class="line">            &#125;,</span><br><span class="line">            target: &#123;</span><br><span class="line">              startAngle: (vbRange[<span class="number">0</span>] + (data[<span class="number">0</span>][<span class="number">1</span>] * vbRange[<span class="number">2</span>])),</span><br><span class="line">              endAngle: (vbRange[<span class="number">0</span>] + ((data[<span class="number">0</span>][<span class="number">1</span>] + <span class="number">1</span>) * vbRange[<span class="number">2</span>])),</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;)</span><br><span class="line">        )</span><br><span class="line">        .attr(<span class="string">'data-source-name'</span>, swap ? vb : va)</span><br><span class="line">        .attr(<span class="string">'data-source-bin'</span>, (data, index) =&gt; <span class="string">`<span class="subst">$&#123;data[<span class="number">0</span>][<span class="number">0</span>]&#125;</span>`</span>)</span><br><span class="line">        .attr(<span class="string">'data-target-name'</span>, swap ? va : vb)</span><br><span class="line">        .attr(<span class="string">'data-target-bin'</span>, (data, iindex) =&gt; <span class="string">`<span class="subst">$&#123;data[<span class="number">0</span>][<span class="number">1</span>]&#125;</span>`</span>)</span><br><span class="line">        .classed(<span class="string">'highlight-pmi'</span>, <span class="literal">false</span>)</span><br><span class="line">        .classed(<span class="string">'positive'</span>, (data, index) =&gt; data[<span class="number">1</span>] &gt;= <span class="number">0.0</span>)</span><br><span class="line">        .classed(<span class="string">'negative'</span>, (data, index) =&gt; data[<span class="number">1</span>] &lt; <span class="number">0.0</span>)</span><br><span class="line">        .attr(<span class="string">'data-details'</span>, (data, index) =&gt; &#123;</span><br><span class="line">          <span class="keyword">var</span> sIdx = swap ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">var</span> tIdx = swap ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">          <span class="keyword">const</span> sourceBinRange = getParamBinRange(data[<span class="number">0</span>][sIdx], histogram1DnumberOfBins, data[<span class="number">2</span>][<span class="number">0</span>]);</span><br><span class="line">          <span class="keyword">const</span> targetBinRange = getParamBinRange(data[<span class="number">0</span>][tIdx], histogram1DnumberOfBins, data[<span class="number">2</span>][<span class="number">1</span>]);</span><br><span class="line">          <span class="keyword">return</span> <span class="string">'PMI: '</span></span><br><span class="line">            + <span class="string">`<span class="subst">$&#123;data[<span class="number">2</span>][<span class="number">0</span>]&#125;</span>  [ <span class="subst">$&#123;formatVal(sourceBinRange[<span class="number">0</span>])&#125;</span>, <span class="subst">$&#123;formatVal(sourceBinRange[<span class="number">1</span>])&#125;</span>]  `</span></span><br><span class="line">            + <span class="string">`<span class="subst">$&#123;data[<span class="number">2</span>][<span class="number">1</span>]&#125;</span>  [ <span class="subst">$&#123;formatVal(targetBinRange[<span class="number">0</span>])&#125;</span>, <span class="subst">$&#123;formatVal(targetBinRange[<span class="number">1</span>])&#125;</span>] <span class="subst">$&#123;formatMI(data[<span class="number">1</span>])&#125;</span>`</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">        .on(<span class="string">'mouseover'</span>, <span class="function"><span class="keyword">function</span> <span class="title">mouseOver</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          publicAPI.updateStatusBarText(d3.select(<span class="keyword">this</span>).attr(<span class="string">'data-details'</span>));</span><br><span class="line">        &#125;)</span><br><span class="line">        .on(<span class="string">'mouseout'</span>, () =&gt; &#123;</span><br><span class="line">          publicAPI.updateStatusBarText(<span class="string">''</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">        .on(<span class="string">'click'</span>, () =&gt; &#123; publicAPI.selectStatusBarText(); &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Mouse move handling ----------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">    svgParent</span><br><span class="line">      <span class="comment">/* eslint-disable prefer-arrow-callback */</span></span><br><span class="line">      <span class="comment">// need d3 provided 'this', below.</span></span><br><span class="line">      .on(<span class="string">'mousemove'</span>, <span class="function"><span class="keyword">function</span> <span class="title">mouseMove</span>(<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">        <span class="comment">/* xxeslint-enable prefer-arrow-callback */</span></span><br><span class="line">        <span class="keyword">const</span> overCoords = d3.mouse(model.container);</span><br><span class="line">        <span class="keyword">const</span> info = findGroupAndBin(overCoords);</span><br><span class="line">        <span class="keyword">let</span> clearStatusBar = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">let</span> groupHoverName = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">let</span> groupInsideName = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">let</span> highlightAllGroups = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> idx = <span class="number">0</span>; idx &lt; variableList.length; ++idx) &#123;</span><br><span class="line">          unHoverBin(variableList[idx]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (info.radius &gt; veryOutermostRadius) &#123;</span><br><span class="line">          highlightAllGroups = <span class="literal">true</span>;</span><br><span class="line">          clearStatusBar = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (info.found) &#123;</span><br><span class="line">          <span class="keyword">if</span> (info.radius &gt; innerRadius &amp;&amp; info.radius &lt;= outerRadius) groupHoverName = info.group;</span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> (info.radius &lt;= innerRadius) groupInsideName = info.group;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">let</span> binMap = &#123;&#125;;</span><br><span class="line">          <span class="keyword">if</span> (!(info.radius &lt;= innerRadius &amp;&amp; pmiChordMode.mode === PMI_CHORD_MODE_NONE)) &#123;</span><br><span class="line">            <span class="keyword">const</span> oneBinAllVarsMode = info.radius &lt;= innerRadius &amp;&amp; pmiChordMode.mode === PMI_CHORD_MODE_ONE_BIN_ALL_VARS;</span><br><span class="line">            model.renderState.pmiHighlight = &#123; <span class="attr">group</span>: info.group, <span class="attr">bin</span>: info.bin, <span class="attr">highlight</span>: <span class="literal">true</span>, <span class="attr">mode</span>: oneBinAllVarsMode &#125;;</span><br><span class="line">            <span class="keyword">const</span> pmiBinMap = findPmiChordsToHighlight();</span><br><span class="line">            <span class="keyword">if</span> (info.radius &lt;= innerRadius) &#123;</span><br><span class="line">              binMap = pmiBinMap;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              svg.select(<span class="string">`g.group[param-name='<span class="subst">$&#123;info.group&#125;</span>'`</span>)</span><br><span class="line">                .selectAll(<span class="string">'path.htile'</span>)</span><br><span class="line">                .each(<span class="function"><span class="keyword">function</span> <span class="title">hTileInner</span>(<span class="params">data, index</span>) </span>&#123;</span><br><span class="line">                  <span class="keyword">if</span> (index === info.bin) &#123;</span><br><span class="line">                    publicAPI.updateStatusBarText(d3.select(<span class="keyword">this</span>).attr(<span class="string">'data-details'</span>));</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!oneBinAllVarsMode) &#123;</span><br><span class="line">              binMap[info.group] = [info.bin];</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          hoverBins(binMap);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          clearStatusBar = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// show a clickable variable legend arc, if hovered, or</span></span><br><span class="line">        <span class="comment">// highlight all groups if a click will reset to default view (veryOutermostRadius)</span></span><br><span class="line">        svg</span><br><span class="line">          .selectAll(<span class="string">`g.group path[id^=\'<span class="subst">$&#123;model.instanceID&#125;</span>-group\']`</span>)</span><br><span class="line">          .classed(style.hoverOutline, (data, idx) =&gt; highlightAllGroups || model.mutualInformationData.vmap[idx].name === groupHoverName);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// show mouse-interaction guide inside the legend arcs.</span></span><br><span class="line">        svg.selectAll(<span class="string">'g.group'</span>).select(<span class="string">`.<span class="subst">$&#123;style.jsMouseArc&#125;</span>`</span>)</span><br><span class="line">          .attr(<span class="string">'class'</span>, (data, idx) =&gt; (model.mutualInformationData.vmap[idx].name === groupInsideName ? style.mouseArcViz : style.mouseArcHidden));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (clearStatusBar === <span class="literal">true</span>) &#123;</span><br><span class="line">          publicAPI.updateStatusBarText(<span class="string">''</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      .on(<span class="string">'mouseout'</span>, (d, i) =&gt; &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> idx = <span class="number">0</span>; idx &lt; variableList.length; ++idx) &#123;</span><br><span class="line">          unHoverBin(variableList[idx]);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      .on(<span class="string">'click'</span>, <span class="comment">// multiClicker([</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">singleClick</span>(<span class="params">d, i</span>) </span>&#123; <span class="comment">// single click handler</span></span><br><span class="line">          <span class="keyword">const</span> overCoords = d3.mouse(model.container);</span><br><span class="line">          <span class="keyword">const</span> info = findGroupAndBin(overCoords);</span><br><span class="line">          <span class="keyword">if</span> (info.radius &gt; veryOutermostRadius) &#123;</span><br><span class="line">            showAllChords();</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (info.radius &gt; outerRadius ||</span><br><span class="line">              (info.radius &lt;= innerRadius &amp;&amp;</span><br><span class="line">              pmiChordMode.mode === PMI_CHORD_MODE_ONE_BIN_ALL_VARS &amp;&amp;</span><br><span class="line">              info.group === pmiChordMode.srcParam)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (info.found) &#123;</span><br><span class="line">              model.renderState.pmiAllBinsTwoVars = <span class="literal">null</span>;</span><br><span class="line">              model.renderState.pmiOneBinAllVars = &#123; <span class="attr">group</span>: info.group, <span class="attr">bin</span>: info.bin, d, i &#125;;</span><br><span class="line">              drawPMIOneBinAllVars()(d, i);</span><br><span class="line">              publicAPI.selectStatusBarText();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        <span class="comment">// &#125;,</span></span><br><span class="line">        &#125;)</span><br><span class="line">      .on(<span class="string">'dblclick'</span>,</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">doubleClick</span>(<span class="params">d, i</span>) </span>&#123; <span class="comment">// double click handler</span></span><br><span class="line">          <span class="keyword">const</span> overCoords = d3.mouse(model.container);</span><br><span class="line">          <span class="keyword">const</span> info = findGroupAndBin(overCoords);</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (info.found) &#123;</span><br><span class="line">            <span class="keyword">let</span> binMap = &#123;&#125;;</span><br><span class="line">            <span class="keyword">const</span> oneBinAllVarsMode = info.radius &lt;= innerRadius &amp;&amp; pmiChordMode.mode === PMI_CHORD_MODE_ONE_BIN_ALL_VARS;</span><br><span class="line">            <span class="keyword">if</span> (info.radius &lt;= innerRadius) &#123;</span><br><span class="line">              model.renderState.pmiHighlight = &#123; <span class="attr">group</span>: info.group, <span class="attr">bin</span>: info.bin, <span class="attr">highlight</span>: <span class="literal">true</span>, <span class="attr">mode</span>: oneBinAllVarsMode &#125;;</span><br><span class="line">              binMap = findPmiChordsToHighlight();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!oneBinAllVarsMode) &#123;</span><br><span class="line">              binMap[info.group] = [info.bin];</span><br><span class="line">            &#125;</span><br><span class="line">            updateActiveSelection(binMap);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          d3.event.stopPropagation();</span><br><span class="line">      <span class="comment">//   &#125;,</span></span><br><span class="line">      <span class="comment">// ])</span></span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="keyword">let</span> miChordsG = svg.select(<span class="string">'g.mutualInfoChords'</span>);</span><br><span class="line">    <span class="keyword">if</span> (miChordsG.empty()) &#123;</span><br><span class="line">      svg.append(<span class="string">'circle'</span>).attr(<span class="string">'r'</span>, outerRadius);</span><br><span class="line">      miChordsG = svg.append(<span class="string">'g'</span>).classed(<span class="string">'mutualInfoChords'</span>, <span class="literal">true</span>);</span><br><span class="line">      svg.append(<span class="string">'g'</span>).classed(<span class="string">'pmiChords'</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// add a straight path so IE/Edge can measure text lengths usefully.</span></span><br><span class="line">      <span class="comment">// Otherwise, along a curved path, they return the horizontal space covered.</span></span><br><span class="line">      svg.append(<span class="string">'defs'</span>).append(<span class="string">'path'</span>)</span><br><span class="line">        .attr(<span class="string">'id'</span>, <span class="string">'straight-text-path'</span>)</span><br><span class="line">        .attr(<span class="string">'d'</span>, <span class="string">`M0,0L<span class="subst">$&#123;width&#125;</span>,0`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Compute the chord layout.</span></span><br><span class="line">    layout.matrix(model.mutualInformationData.matrix);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get lookups for pmi chords</span></span><br><span class="line">    model.mutualInformationData.lkup = &#123;&#125;;</span><br><span class="line">    <span class="built_in">Object</span>.keys(model.mutualInformationData.vmap).forEach(<span class="function">(<span class="params">i</span>) =&gt;</span> &#123;</span><br><span class="line">      model.mutualInformationData.lkup[model.mutualInformationData.vmap[i].name] = i;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Only used when there is no legend service</span></span><br><span class="line">    <span class="keyword">const</span> cmap = d3.scale.category20();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add a group per neighborhood.</span></span><br><span class="line">    <span class="keyword">const</span> group = svg</span><br><span class="line">      .selectAll(<span class="string">'.group'</span>)</span><br><span class="line">      <span class="comment">// set a key === field name, so groups are re-used. Need a fall-back for removed fields, though.</span></span><br><span class="line">      .data(layout.groups, d =&gt; (model.mutualInformationData.vmap[d.index] ? model.mutualInformationData.vmap[d.index].name : d.index));</span><br><span class="line">    <span class="keyword">const</span> groupEnter = group</span><br><span class="line">      .enter()</span><br><span class="line">      .append(<span class="string">'g'</span>)</span><br><span class="line">      .classed(<span class="string">'group'</span>, <span class="literal">true</span>)</span><br><span class="line">      .classed(style.group, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add the group arc.</span></span><br><span class="line">    groupEnter</span><br><span class="line">      .append(<span class="string">'path'</span>)</span><br><span class="line">      .attr(<span class="string">'id'</span>, (d, i) =&gt; <span class="string">`<span class="subst">$&#123;model.instanceID&#125;</span>-group<span class="subst">$&#123;i&#125;</span>`</span>);</span><br><span class="line">    <span class="comment">// add mouse-interaction arc - show where mouse affects this group's chords.</span></span><br><span class="line">    groupEnter</span><br><span class="line">      .append(<span class="string">'path'</span>)</span><br><span class="line">      .classed(style.mouseArcHidden, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add a text label.</span></span><br><span class="line">    <span class="keyword">const</span> groupText = groupEnter</span><br><span class="line">      .append(<span class="string">'text'</span>)</span><br><span class="line">      <span class="comment">// .attr('x', 6) // prevents ie11 from seeing text-anchor and startOffset.</span></span><br><span class="line">      .attr(<span class="string">'dy'</span>, <span class="number">15</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!model.textLengthMap) model.textLengthMap = &#123;&#125;;</span><br><span class="line">    groupText</span><br><span class="line">      .append(<span class="string">'textPath'</span>)</span><br><span class="line">      .attr(<span class="string">'startOffset'</span>, <span class="string">'25%'</span>)</span><br><span class="line">      .text(<span class="function">(<span class="params">d, i</span>) =&gt;</span> model.mutualInformationData.vmap[i].name);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// enter + update items.</span></span><br><span class="line">    <span class="keyword">const</span> groupPath = group.select(<span class="string">'path'</span>)</span><br><span class="line">      .attr(<span class="string">'d'</span>, arc);</span><br><span class="line">    group.select(<span class="string">`.<span class="subst">$&#123;style.jsMouseArc&#125;</span>`</span>)</span><br><span class="line">      .attr(<span class="string">'d'</span>, insideArc);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> textPath = group</span><br><span class="line">      .select(<span class="string">'text'</span>).select(<span class="string">'textPath'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// pull a stunt to measure text length - use a straight path, then switch to the real curved one.</span></span><br><span class="line">    textPath.filter(<span class="function"><span class="params">d</span> =&gt;</span> (!model.textLengthMap[model.mutualInformationData.vmap[d.index].name]))</span><br><span class="line">      .text(<span class="function"><span class="params">d</span> =&gt;</span> model.mutualInformationData.vmap[d.index].name)</span><br><span class="line">      .attr(<span class="string">'xlink:href'</span>, <span class="string">'#straight-text-path'</span>)</span><br><span class="line">      .each(<span class="function"><span class="keyword">function</span> <span class="title">textLen</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">        model.textLengthMap[model.mutualInformationData.vmap[d.index].name] = <span class="keyword">this</span>.getComputedTextLength();</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    textPath</span><br><span class="line">      .attr(<span class="string">'xlink:href'</span>, (d, i) =&gt; <span class="string">`#<span class="subst">$&#123;model.instanceID&#125;</span>-group<span class="subst">$&#123;d.index&#125;</span>`</span>)</span><br><span class="line">      <span class="comment">// Remove the labels that don't fit, or shorten label, using ...</span></span><br><span class="line">      .each(<span class="function"><span class="keyword">function</span> <span class="title">truncate</span>(<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">        d.textShown = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">const</span> availLength = ((groupPath[<span class="number">0</span>][d.index].getTotalLength() / <span class="number">2</span>) - deltaRadius - model.glyphSize);</span><br><span class="line">        <span class="comment">// shorten text based on string length vs initial total length.</span></span><br><span class="line">        <span class="keyword">const</span> fullText = model.mutualInformationData.vmap[i].name;</span><br><span class="line">        <span class="keyword">const</span> textLength = model.textLengthMap[fullText];</span><br><span class="line">        <span class="keyword">const</span> strLength = fullText.length;</span><br><span class="line">        <span class="comment">// we fit! done.</span></span><br><span class="line">        <span class="keyword">if</span> (textLength &lt;= availLength) &#123;</span><br><span class="line">          d3.select(<span class="keyword">this</span>).text(fullText);</span><br><span class="line">          d.textLength = textLength;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// if we don't have 15 pixels left, or short string, don't show label.</span></span><br><span class="line">        <span class="keyword">if</span> (availLength &lt; <span class="number">15</span> || strLength &lt; <span class="number">9</span>) &#123;</span><br><span class="line">          d.textShown = <span class="literal">false</span>;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// drop the middle 50%.</span></span><br><span class="line">        <span class="keyword">let</span> testStrLen = <span class="built_in">Math</span>.floor(strLength * <span class="number">0.25</span>);</span><br><span class="line">        <span class="comment">// estimate new length, +2 to account for adding '...'</span></span><br><span class="line">        d.textLength = (((testStrLen * <span class="number">2</span>) + <span class="number">2</span>) / strLength) * textLength;</span><br><span class="line">        <span class="keyword">if</span> (d.textLength &lt; availLength) &#123;</span><br><span class="line">          d3.select(<span class="keyword">this</span>).text(<span class="string">`<span class="subst">$&#123;fullText.slice(<span class="number">0</span>, testStrLen)&#125;</span>...<span class="subst">$&#123;fullText.slice(-testStrLen)&#125;</span>`</span>);</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// start at 1/3 of the string, go down to 3 chars plus ...</span></span><br><span class="line">        testStrLen = <span class="built_in">Math</span>.floor(strLength / <span class="number">2.99</span>);</span><br><span class="line">        <span class="keyword">while</span> (testStrLen &gt;= <span class="number">3</span>) &#123;</span><br><span class="line">          d.textLength = ((testStrLen + <span class="number">2</span>) / strLength) * textLength;</span><br><span class="line">          <span class="keyword">if</span> (d.textLength &lt; availLength) &#123;</span><br><span class="line">            d3.select(<span class="keyword">this</span>).text(<span class="string">`<span class="subst">$&#123;fullText.slice(<span class="number">0</span>, testStrLen)&#125;</span>...`</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          testStrLen -= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// small string doesn't fit - hide.</span></span><br><span class="line">        d.textShown = <span class="literal">false</span>;</span><br><span class="line">      &#125;)</span><br><span class="line">      .attr(<span class="string">'display'</span>, (d, i) =&gt; (d.textShown ? <span class="literal">null</span> : <span class="string">'none'</span>));</span><br><span class="line">      <span class="comment">// .remove(); ie11 throws errors if we use .remove() - hide instead.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add group for glyph, or assign color as fallback.</span></span><br><span class="line">    group.each(<span class="function"><span class="keyword">function</span> <span class="title">addLegend</span>(<span class="params">glyphData</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (getLegend) &#123;</span><br><span class="line">        <span class="keyword">let</span> glyph = d3.select(<span class="keyword">this</span>).select(<span class="string">'g.glyph'</span>);</span><br><span class="line">        <span class="keyword">if</span> (glyph.empty()) &#123;</span><br><span class="line">          glyph = d3.select(<span class="keyword">this</span>)</span><br><span class="line">            .append(<span class="string">'g'</span>)</span><br><span class="line">            .classed(<span class="string">'glyph'</span>, <span class="literal">true</span>)</span><br><span class="line">            .classed(style.glyph, <span class="literal">true</span>);</span><br><span class="line">          glyph</span><br><span class="line">            .append(<span class="string">'svg'</span>)</span><br><span class="line">            .append(<span class="string">'use'</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> legend = getLegend(model.mutualInformationData.vmap[glyphData.index].name);</span><br><span class="line">        <span class="comment">// Add the glyph to the group</span></span><br><span class="line">        <span class="keyword">const</span> textLength = glyphData.textShown ? glyphData.textLength : <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">const</span> pathLength = groupPath[<span class="number">0</span>][glyphData.index].getTotalLength();</span><br><span class="line">        <span class="keyword">const</span> avgRadius = (innerRadius + outerRadius) / <span class="number">2</span>;</span><br><span class="line">        <span class="comment">// Start at edge of arc, move to text anchor, back up half of text length and glyph size</span></span><br><span class="line">        <span class="keyword">const</span> glyphAngle = (glyphData.startAngle + (pathLength * <span class="number">0.25</span> / outerRadius) - ((textLength + model.glyphSize) * <span class="number">0.5</span> / avgRadius));</span><br><span class="line">        <span class="comment">// console.log(model.mutualInformationData.vmap[glyphData.index].name, textLength, pathLength, glyphAngle);</span></span><br><span class="line"></span><br><span class="line">        glyph</span><br><span class="line">          .attr(<span class="string">'transform'</span>, <span class="string">`translate(</span></span><br><span class="line"><span class="string">            <span class="subst">$&#123;(avgRadius * <span class="built_in">Math</span>.sin(glyphAngle)) - (model.glyphSize <span class="regexp">/ 2)&#125;,</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">            $&#123;(-avgRadius * Math.cos(glyphAngle)) - (model.glyphSize /</span> <span class="number">2</span>)&#125;</span>)`</span>)</span><br><span class="line">          .select(<span class="string">'svg'</span>)</span><br><span class="line">          .attr(<span class="string">'width'</span>, model.glyphSize)</span><br><span class="line">          .attr(<span class="string">'height'</span>, model.glyphSize)</span><br><span class="line">          .attr(<span class="string">'stroke'</span>, <span class="string">'black'</span>)</span><br><span class="line">          .attr(<span class="string">'fill'</span>, legend.color)</span><br><span class="line">          .select(<span class="string">'use'</span>)</span><br><span class="line">          .attr(<span class="string">'xlink:href'</span>, legend.shape);</span><br><span class="line"></span><br><span class="line">        model.mutualInformationData.vmap[glyphData.index].color = legend.color;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Remove the glyphs that don't fit</span></span><br><span class="line">        <span class="keyword">if</span> ((groupPath[<span class="number">0</span>][glyphData.index].getTotalLength() / <span class="number">2</span>) - deltaRadius &lt; model.glyphSize) &#123;</span><br><span class="line">          <span class="comment">// glyph.remove(); ie11 objects, hide instead.</span></span><br><span class="line">          glyph.attr(<span class="string">'display'</span>, <span class="string">'none'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        model.mutualInformationData.vmap[glyphData.index].color = cmap(glyphData.index);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add the color to the group arc</span></span><br><span class="line">    group</span><br><span class="line">      .select(<span class="string">'path'</span>)</span><br><span class="line">      .style(<span class="string">'fill'</span>, d =&gt; model.mutualInformationData.vmap[d.index].color || <span class="string">'red'</span>);</span><br><span class="line">    group</span><br><span class="line">      .select(<span class="string">`.<span class="subst">$&#123;style.jsMouseArc&#125;</span>`</span>)</span><br><span class="line">      .style(<span class="string">'fill'</span>, d =&gt; model.mutualInformationData.vmap[d.index].color || <span class="string">'red'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getParamBinRange</span>(<span class="params">index, numberOfBins, paramName</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">const</span> paramRange = model.provider.getField(paramName).range;</span><br><span class="line">      <span class="keyword">return</span> getBinRange(index, numberOfBins,</span><br><span class="line">        [paramRange[<span class="number">0</span>], paramRange[<span class="number">1</span>], paramRange[<span class="number">1</span>] - paramRange[<span class="number">0</span>]]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getBinRange</span>(<span class="params">index, numberOfBins, paramRange</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> [</span><br><span class="line">        (index / numberOfBins * paramRange[<span class="number">2</span>]) + paramRange[<span class="number">0</span>],</span><br><span class="line">        ((index + <span class="number">1</span>) / numberOfBins * paramRange[<span class="number">2</span>]) + paramRange[<span class="number">0</span>],</span><br><span class="line">      ];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Zip histogram info into layout.groups() (which we initially have no control over as it is</span></span><br><span class="line">    <span class="comment">// generated for us).</span></span><br><span class="line">    group</span><br><span class="line">      .each(<span class="function"><span class="keyword">function</span> <span class="title">buildHistogram</span>(<span class="params">groupData</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> gname = model.mutualInformationData.vmap[groupData.index].name;</span><br><span class="line">        <span class="keyword">const</span> gvar = model.histogramData[gname];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!gvar) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        groupData.range = [gvar.min, gvar.max, gvar.max - gvar.min];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> delta = (groupData.endAngle - groupData.startAngle) / gvar.counts.length;</span><br><span class="line">        <span class="keyword">const</span> total = <span class="built_in">Number</span>(gvar.counts.reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b));</span><br><span class="line">        <span class="keyword">const</span> maxcnt = <span class="built_in">Number</span>(gvar.counts.reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> (a &gt; b ? a : b)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* eslint-disable arrow-body-style */</span></span><br><span class="line">        groupData.histo = gvar.counts.map(<span class="function">(<span class="params">d, i</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123;</span><br><span class="line">            startAngle: ((i * delta) + groupData.startAngle),</span><br><span class="line">            endAngle: (((i + <span class="number">1</span>) * delta) + groupData.startAngle),</span><br><span class="line">            innerRadius: (outerRadius + <span class="number">10</span>),</span><br><span class="line">            outerRadius: (outerRadius + <span class="number">10</span> + (d / maxcnt * (histoRadius - outerRadius))),</span><br><span class="line">            index: i,</span><br><span class="line">            value: (d / total),</span><br><span class="line">          &#125;;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> htile = d3.select(<span class="keyword">this</span>)</span><br><span class="line">          .attr(<span class="string">'param-name'</span>, gname)</span><br><span class="line">          .selectAll(<span class="string">'path.htile'</span>)</span><br><span class="line">          .data(groupData.histo);</span><br><span class="line">        htile</span><br><span class="line">          .enter()</span><br><span class="line">          .append(<span class="string">'path'</span>)</span><br><span class="line">          .classed(<span class="string">'htile'</span>, <span class="literal">true</span>);</span><br><span class="line">        htile</span><br><span class="line">          .attr(<span class="string">'d'</span>, (d, i) =&gt; histoArc.outerRadius(d.outerRadius)(d))</span><br><span class="line">          .attr(<span class="string">'data-details'</span>, (d, i) =&gt; &#123;</span><br><span class="line">            <span class="keyword">const</span> binRange = getBinRange(i, histogram1DnumberOfBins, groupData.range);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">`p(<span class="subst">$&#123;gname&#125;</span>  [<span class="subst">$&#123;formatVal(binRange[<span class="number">0</span>])&#125;</span>, <span class="subst">$&#123;formatVal(binRange[<span class="number">1</span>])&#125;</span>]) = <span class="subst">$&#123;formatPercent(d.value)&#125;</span>`</span>;</span><br><span class="line">          &#125;)</span><br><span class="line">          .attr(<span class="string">'fill'</span>, (d, i) =&gt; (i % <span class="number">2</span> ? <span class="string">'#bebebe'</span> : <span class="string">'#a9a9a9'</span>));</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">showAllChords</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      pmiChordMode.mode = PMI_CHORD_MODE_NONE;</span><br><span class="line">      pmiChordMode.srcParam = <span class="literal">null</span>;</span><br><span class="line">      pmiChordMode.srcBin = <span class="literal">null</span>;</span><br><span class="line">      pmiChordMode.miIndex = <span class="number">-1</span>;</span><br><span class="line">      model.renderState = &#123;</span><br><span class="line">        pmiAllBinsTwoVars: <span class="literal">null</span>,</span><br><span class="line">        pmiOneBinAllVars: <span class="literal">null</span>,</span><br><span class="line">        pmiHighlight: <span class="literal">null</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">      updateChordVisibility(&#123; <span class="attr">mi</span>: &#123; <span class="attr">show</span>: <span class="literal">true</span> &#125; &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// do we need to reset?</span></span><br><span class="line">    <span class="keyword">const</span> groupExit = group.exit();</span><br><span class="line">    <span class="keyword">const</span> needReset = (!groupEnter.empty() || !groupExit.empty());</span><br><span class="line">    groupExit.remove();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add the chords. Color only chords that show self-mutual-information.</span></span><br><span class="line">    <span class="keyword">const</span> chord = miChordsG</span><br><span class="line">      .selectAll(<span class="string">'.chord'</span>)</span><br><span class="line">      .data(layout.chords);</span><br><span class="line">    chord</span><br><span class="line">      .enter()</span><br><span class="line">      .append(<span class="string">'path'</span>)</span><br><span class="line">      .classed(<span class="string">'chord'</span>, <span class="literal">true</span>)</span><br><span class="line">      .classed(style.chord, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    chord.exit().remove();</span><br><span class="line"></span><br><span class="line">    chord</span><br><span class="line">      .classed(<span class="string">'selfchord'</span>, d =&gt; (d.source.index === d.target.index))</span><br><span class="line">      .attr(<span class="string">'d'</span>, path)</span><br><span class="line">      .style(<span class="string">'fill'</span>, <span class="literal">null</span>)</span><br><span class="line">      .on(<span class="string">'click'</span>, (d, i) =&gt; &#123;</span><br><span class="line">        model.renderState.pmiOneBinAllVars = <span class="literal">null</span>;</span><br><span class="line">        model.renderState.pmiAllBinsTwoVars = &#123; d, i &#125;;</span><br><span class="line">        drawPMIAllBinsTwoVars();</span><br><span class="line">        publicAPI.selectStatusBarText();</span><br><span class="line">      &#125;)</span><br><span class="line">      .on(<span class="string">'mouseover'</span>, <span class="function"><span class="keyword">function</span> <span class="title">inner</span>(<span class="params">d, i</span>) </span>&#123;</span><br><span class="line">        publicAPI.updateStatusBarText(d3.select(<span class="keyword">this</span>).attr(<span class="string">'data-details'</span>));</span><br><span class="line">      &#125;)</span><br><span class="line">      .on(<span class="string">'mouseout'</span>, () =&gt; &#123;</span><br><span class="line">        publicAPI.updateStatusBarText(<span class="string">''</span>);</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    miChordsG</span><br><span class="line">      .selectAll(<span class="string">'.selfchord'</span>)</span><br><span class="line">      .style(<span class="string">'fill'</span>, d =&gt; model.mutualInformationData.vmap[d.source.index].color);</span><br><span class="line"></span><br><span class="line">    chord</span><br><span class="line">      .attr(<span class="string">'data-details'</span>, (d, i) =&gt;</span><br><span class="line">        <span class="string">`Mutual information: <span class="subst">$&#123;model.mutualInformationData.vmap[d.source.index].name&#125;</span>  <span class="subst">$&#123;model.mutualInformationData.vmap[d.target.index].name&#125;</span> `</span></span><br><span class="line">        + <span class="string">`<span class="subst">$&#123;formatMI(model.mutualInformationData.matrix[d.source.index][d.target.index])&#125;</span>`</span>);</span><br><span class="line">    <span class="comment">// The lines below are for the case when the MI matrix has been row-normalized:</span></span><br><span class="line">    <span class="comment">// model.mutualInformationData.matrix[d.source.index][d.target.index] *</span></span><br><span class="line">    <span class="comment">// model.mutualInformationData.vmap[d.source.index].autoInfo/model.mutualInformationData.matrix[d.source.index][d.source.index]);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// after chord is defined.</span></span><br><span class="line">    <span class="keyword">if</span> (needReset) &#123;</span><br><span class="line">      showAllChords();</span><br><span class="line">      publicAPI.updateStatusBarText(<span class="string">''</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    svg</span><br><span class="line">      .selectAll(<span class="string">`g.group path[id^=\'<span class="subst">$&#123;model.instanceID&#125;</span>-group\']`</span>)</span><br><span class="line">      .on(<span class="string">'click'</span>, (d, i) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (pmiChordMode.mode !== PMI_CHORD_MODE_NONE || pmiChordMode.miIndex !== i) &#123;</span><br><span class="line">          pmiChordMode.mode = PMI_CHORD_MODE_NONE;</span><br><span class="line">          pmiChordMode.srcParam = <span class="literal">null</span>;</span><br><span class="line">          pmiChordMode.srcBin = <span class="literal">null</span>;</span><br><span class="line">          pmiChordMode.miIndex = i;</span><br><span class="line">          updateChordVisibility(&#123; <span class="attr">mi</span>: &#123; <span class="attr">show</span>: <span class="literal">true</span>, <span class="attr">index</span>: i &#125; &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          showAllChords();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (model.renderState.pmiAllBinsTwoVars !== <span class="literal">null</span> &amp;&amp; pmiChordMode.mode === PMI_CHORD_MODE_ALL_BINS_TWO_VARS) &#123;</span><br><span class="line">      drawPMIAllBinsTwoVars();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (model.renderState.pmiOneBinAllVars !== <span class="literal">null</span> &amp;&amp; pmiChordMode.mode === PMI_CHORD_MODE_ONE_BIN_ALL_VARS) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">group</span>: g, <span class="attr">bin</span>: b, d, i &#125; = model.renderState.pmiOneBinAllVars;</span><br><span class="line">      drawPMIOneBinAllVars(g, b)(d, i);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// only happens on 'needReset', above.</span></span><br><span class="line">      <span class="comment">// showAllChords();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (model.renderState.pmiHighlight !== <span class="literal">null</span> &amp;&amp; pmiChordMode.mode !== PMI_CHORD_MODE_NONE) &#123;</span><br><span class="line">      findPmiChordsToHighlight();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">drawPMIOneBinAllVars</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> binVar = model.renderState.pmiOneBinAllVars.group; <span class="comment">// Hold on to the name of the variable whose bin we should draw.</span></span><br><span class="line">      <span class="keyword">var</span> binIdx = model.renderState.pmiOneBinAllVars.bin;</span><br><span class="line"></span><br><span class="line">      pmiChordMode.mode = PMI_CHORD_MODE_ONE_BIN_ALL_VARS;</span><br><span class="line">      pmiChordMode.srcParam = binVar;</span><br><span class="line">      pmiChordMode.srcBin = binIdx;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Return a function that, given a bin datum, renders the highest PMI (or probability)</span></span><br><span class="line">      <span class="comment">// links from that bin to any/all other bins in other variables it co-occurs with.</span></span><br><span class="line">      <span class="keyword">return</span> <span class="function">(<span class="params">d, i</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// Turn off MI rendering</span></span><br><span class="line">        chord.classed(<span class="string">'fade'</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Turn on PMI rendering</span></span><br><span class="line">        <span class="keyword">let</span> linkAccum = [];</span><br><span class="line">        <span class="built_in">Object</span>.keys(model.mutualInformationData.vmap).forEach(<span class="function">(<span class="params">iother</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">var</span> other = model.mutualInformationData.vmap[iother];</span><br><span class="line">          <span class="keyword">let</span> va = binVar;</span><br><span class="line">          <span class="keyword">let</span> vb = other.name;</span><br><span class="line">          <span class="keyword">if</span> (!vb || vb === va) &#123;</span><br><span class="line">            <span class="keyword">return</span>; <span class="comment">// Can't draw links to self...</span></span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">let</span> swap = <span class="literal">false</span>;</span><br><span class="line">          <span class="keyword">if</span> (vb &lt; va) &#123;</span><br><span class="line">            <span class="keyword">const</span> tmp = vb;</span><br><span class="line">            vb = va;</span><br><span class="line">            va = tmp;</span><br><span class="line">            swap = <span class="literal">true</span>;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">const</span> cAB = downsample(model.mutualInformationData.joint[va][vb], histogram1DnumberOfBins, swap);</span><br><span class="line">          <span class="keyword">const</span> probDict = freqToProb(cAB);</span><br><span class="line">          <span class="keyword">const</span> linksToDraw = topBinPmi(probDict, <span class="literal">true</span>, binIdx, <span class="number">0.8</span>);</span><br><span class="line">          linkAccum = linkAccum.concat(</span><br><span class="line">            d3.zip(</span><br><span class="line">              linksToDraw.idx, linksToDraw.pmi, linksToDraw.pAB,</span><br><span class="line">              <span class="keyword">new</span> <span class="built_in">Array</span>(linksToDraw.idx.length).fill([binVar, other.name])</span><br><span class="line">            )</span><br><span class="line">          );</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Make mutual info chords invisible.</span></span><br><span class="line">        svg.selectAll(<span class="string">'g.group path.chord'</span>)</span><br><span class="line">          .classed(<span class="string">'fade'</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> linkData = svg</span><br><span class="line">          .select(<span class="string">'g.pmiChords'</span>)</span><br><span class="line">          .selectAll(<span class="string">'path.pmiChord'</span>)</span><br><span class="line">          .data(linkAccum);</span><br><span class="line"></span><br><span class="line">        linkData.enter().append(<span class="string">'path'</span>)</span><br><span class="line">          .classed(<span class="string">'pmiChord'</span>, <span class="literal">true</span>)</span><br><span class="line">          .classed(style.pmiChord, <span class="literal">true</span>);</span><br><span class="line">        linkData.exit().remove();</span><br><span class="line"></span><br><span class="line">        linkData</span><br><span class="line">          .classed(<span class="string">'fade'</span>, <span class="literal">false</span>)</span><br><span class="line">          .attr(<span class="string">'d'</span>, (data, index) =&gt; &#123;</span><br><span class="line">            <span class="keyword">var</span> vaGrp = layout.groups()[model.mutualInformationData.lkup[data[<span class="number">3</span>][<span class="number">0</span>]]];</span><br><span class="line">            <span class="keyword">var</span> vbGrp = layout.groups()[model.mutualInformationData.lkup[data[<span class="number">3</span>][<span class="number">1</span>]]];</span><br><span class="line">            <span class="keyword">var</span> vaRange = [vaGrp.startAngle, (vaGrp.endAngle - vaGrp.startAngle), (vaGrp.endAngle - vaGrp.startAngle) / histogram1DnumberOfBins];</span><br><span class="line">            <span class="keyword">var</span> vbRange = [vbGrp.startAngle, (vbGrp.endAngle - vbGrp.startAngle), (vbGrp.endAngle - vbGrp.startAngle) / histogram1DnumberOfBins];</span><br><span class="line">            <span class="keyword">return</span> path(&#123;</span><br><span class="line">              source: &#123;</span><br><span class="line">                startAngle: (vaRange[<span class="number">0</span>] + (data[<span class="number">0</span>][<span class="number">0</span>] * vaRange[<span class="number">2</span>])),</span><br><span class="line">                endAngle: (vaRange[<span class="number">0</span>] + ((data[<span class="number">0</span>][<span class="number">0</span>] + <span class="number">1</span>) * vaRange[<span class="number">2</span>])),</span><br><span class="line">              &#125;,</span><br><span class="line">              target: &#123;</span><br><span class="line">                startAngle: (vbRange[<span class="number">0</span>] + (data[<span class="number">0</span>][<span class="number">1</span>] * vbRange[<span class="number">2</span>])),</span><br><span class="line">                endAngle: (vbRange[<span class="number">0</span>] + ((data[<span class="number">0</span>][<span class="number">1</span>] + <span class="number">1</span>) * vbRange[<span class="number">2</span>])),</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;)</span><br><span class="line">          .attr(<span class="string">'data-source-name'</span>, data =&gt; data[<span class="number">3</span>][<span class="number">0</span>])</span><br><span class="line">          .attr(<span class="string">'data-source-bin'</span>, data =&gt; data[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">          .attr(<span class="string">'data-target-name'</span>, data =&gt; data[<span class="number">3</span>][<span class="number">1</span>])</span><br><span class="line">          .attr(<span class="string">'data-target-bin'</span>, data =&gt; data[<span class="number">0</span>][<span class="number">1</span>])</span><br><span class="line">          .classed(<span class="string">'highlight-pmi'</span>, <span class="literal">false</span>)</span><br><span class="line">          .classed(<span class="string">'positive'</span>, data =&gt; data[<span class="number">1</span>] &gt;= <span class="number">0.0</span>)</span><br><span class="line">          .classed(<span class="string">'negative'</span>, data =&gt; data[<span class="number">1</span>] &lt; <span class="number">0.0</span>)</span><br><span class="line">          .attr(<span class="string">'data-details'</span>, (data) =&gt; &#123;</span><br><span class="line">            <span class="keyword">const</span> sourceBinRange = getParamBinRange(data[<span class="number">0</span>][<span class="number">0</span>], histogram1DnumberOfBins, data[<span class="number">3</span>][<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">const</span> targetBinRange = getParamBinRange(data[<span class="number">0</span>][<span class="number">1</span>], histogram1DnumberOfBins, data[<span class="number">3</span>][<span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'PMI: '</span></span><br><span class="line">              + <span class="string">`<span class="subst">$&#123;data[<span class="number">3</span>][<span class="number">0</span>]&#125;</span>  [ <span class="subst">$&#123;formatVal(sourceBinRange[<span class="number">0</span>])&#125;</span>, <span class="subst">$&#123;formatVal(sourceBinRange[<span class="number">1</span>])&#125;</span>]  `</span></span><br><span class="line">              + <span class="string">`<span class="subst">$&#123;data[<span class="number">3</span>][<span class="number">1</span>]&#125;</span>  [ <span class="subst">$&#123;formatVal(targetBinRange[<span class="number">0</span>])&#125;</span>, <span class="subst">$&#123;formatVal(targetBinRange[<span class="number">1</span>])&#125;</span>] <span class="subst">$&#123;formatMI(data[<span class="number">1</span>])&#125;</span>`</span>;</span><br><span class="line">          &#125;)</span><br><span class="line">          .on(<span class="string">'mouseover'</span>, <span class="function"><span class="keyword">function</span> <span class="title">mouseOver</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            publicAPI.updateStatusBarText(d3.select(<span class="keyword">this</span>).attr(<span class="string">'data-details'</span>));</span><br><span class="line">          &#125;)</span><br><span class="line">          .on(<span class="string">'mouseout'</span>, () =&gt; &#123;</span><br><span class="line">            publicAPI.updateStatusBarText(<span class="string">''</span>);</span><br><span class="line">          &#125;)</span><br><span class="line">          .on(<span class="string">'click'</span>, () =&gt; &#123; publicAPI.selectStatusBarText(); &#125;);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleHoverUpdate</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> svg = d3.select(model.container);</span><br><span class="line">    <span class="built_in">Object</span>.keys(data.state).forEach(<span class="function">(<span class="params">pName</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> binList = data.state[pName];</span><br><span class="line">      svg.selectAll(<span class="string">`g.group[param-name='<span class="subst">$&#123;pName&#125;</span>'] &gt; path.htile`</span>)</span><br><span class="line">        .classed(<span class="string">'hilite'</span>, (d, i) =&gt;</span><br><span class="line">          binList.indexOf(<span class="number">-1</span>) === <span class="number">-1</span> &amp;&amp; binList.indexOf(i) &gt;= <span class="number">0</span></span><br><span class="line">        );</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Make sure default values get applied</span></span><br><span class="line">  publicAPI.setContainer(model.container);</span><br><span class="line"></span><br><span class="line">  model.subscriptions.push(&#123; <span class="attr">unsubscribe</span>: publicAPI.setContainer &#125;);</span><br><span class="line">  model.subscriptions.push(model.provider.onFieldChange(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    model.renderState = &#123;</span><br><span class="line">      pmiAllBinsTwoVars: <span class="literal">null</span>,</span><br><span class="line">      pmiOneBinAllVars: <span class="literal">null</span>,</span><br><span class="line">      pmiHighlight: <span class="literal">null</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span> (model.provider.setMutualInformationParameterNames) &#123;</span><br><span class="line">      model.provider.setMutualInformationParameterNames(model.provider.getActiveFieldNames());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (model.provider.isA(<span class="string">'Histogram1DProvider'</span>)) &#123;</span><br><span class="line">    model.histogram1DDataSubscription = model.provider.subscribeToHistogram1D(</span><br><span class="line">      (data) =&gt; &#123;</span><br><span class="line">        model.histogramData = data;</span><br><span class="line">        publicAPI.render();</span><br><span class="line">      &#125;,</span><br><span class="line">      model.provider.getFieldNames(),</span><br><span class="line">      &#123;</span><br><span class="line">        numberOfBins: model.numberOfBins,</span><br><span class="line">        partial: <span class="literal">false</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    model.subscriptions.push(model.histogram1DDataSubscription);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (model.provider.isA(<span class="string">'MutualInformationProvider'</span>)) &#123;</span><br><span class="line">    model.mutualInformationDataSubscription = model.provider.onMutualInformationReady(</span><br><span class="line">      (data) =&gt; &#123;</span><br><span class="line">        model.mutualInformationData = data;</span><br><span class="line">        publicAPI.render();</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    model.subscriptions.push(model.mutualInformationDataSubscription);</span><br><span class="line">    model.provider.setMutualInformationParameterNames(model.provider.getActiveFieldNames());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (model.provider.isA(<span class="string">'HistogramBinHoverProvider'</span>)) &#123;</span><br><span class="line">    model.subscriptions.push(model.provider.onHoverBinChange(handleHoverUpdate));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (model.provider.isA(<span class="string">'SelectionProvider'</span>)) &#123;</span><br><span class="line">    model.subscriptions.push(model.provider.onAnnotationChange(<span class="function">(<span class="params">annotation</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (lastAnnotationPushed</span><br><span class="line">        &amp;&amp; annotation.selection.type === <span class="string">'range'</span></span><br><span class="line">        &amp;&amp; annotation.id === lastAnnotationPushed.id</span><br><span class="line">        &amp;&amp; annotation.generation === lastAnnotationPushed.generation + <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// Assume that it is still ours but edited by someone else</span></span><br><span class="line">        lastAnnotationPushed = annotation;</span><br><span class="line">        <span class="comment">// Capture the score and update our default</span></span><br><span class="line">        model.defaultScore = lastAnnotationPushed.score[<span class="number">0</span>];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// Object factory</span></span><br><span class="line"><span class="comment">// ----------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> DEFAULT_VALUES = &#123;</span><br><span class="line">  container: <span class="literal">null</span>,</span><br><span class="line">  provider: <span class="literal">null</span>,</span><br><span class="line"></span><br><span class="line">  needData: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">  glyphSize: <span class="number">15</span>,</span><br><span class="line"></span><br><span class="line">  statusBarVisible: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">  useAnnotation: <span class="literal">false</span>,</span><br><span class="line">  defaultScore: <span class="number">0</span>,</span><br><span class="line">  defaultWeight: <span class="number">1</span>,</span><br><span class="line"></span><br><span class="line">  numberOfBins: <span class="number">32</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">extend</span>(<span class="params">publicAPI, model, initialValues = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">Object</span>.assign(model, DEFAULT_VALUES, initialValues);</span><br><span class="line"></span><br><span class="line">  CompositeClosureHelper.destroy(publicAPI, model);</span><br><span class="line">  CompositeClosureHelper.isA(publicAPI, model, <span class="string">'VizComponent'</span>);</span><br><span class="line">  CompositeClosureHelper.get(publicAPI, model, [<span class="string">'provider'</span>, <span class="string">'container'</span>, <span class="string">'numberOfBins'</span>]);</span><br><span class="line">  CompositeClosureHelper.set(publicAPI, model, [<span class="string">'numberOfBins'</span>]);</span><br><span class="line">  CompositeClosureHelper.dynamicArray(publicAPI, model, <span class="string">'readOnlyFields'</span>);</span><br><span class="line"></span><br><span class="line">  informationDiagram(publicAPI, model);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> newInstance = CompositeClosureHelper.newInstance(extend);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123; newInstance, extend &#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>utils.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">// -----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// -- Private utility methods for dealing with joint (2d) probability distributions --</span></span><br><span class="line"><span class="comment">// -----------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">constantMatrix</span>(<span class="params">ii, jj, entry</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> arr = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; ii; ++i) &#123;</span><br><span class="line">    arr.push([]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; jj; ++j) &#123;</span><br><span class="line">      arr[i].push(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">zeros</span>(<span class="params">ii, jj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> constantMatrix(ii, jj, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">downsample</span>(<span class="params">src, nn, swap</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> hsz = src ? src.length : <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">var</span> arr;</span><br><span class="line">  <span class="keyword">if</span> (hsz === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (nn &lt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// assert(hsz === src[0].length);</span></span><br><span class="line">  <span class="keyword">let</span> tn = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (tn &lt; nn &amp;&amp; tn &lt; hsz) &#123; tn *= <span class="number">2</span>; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> stride = hsz / tn;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (stride === <span class="number">1</span> &amp;&amp; !swap) &#123;</span><br><span class="line">    arr = src;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    arr = zeros(tn, tn);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; hsz; ++i) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; hsz; ++j) &#123;</span><br><span class="line">        arr[<span class="built_in">Math</span>.floor(i / stride)][<span class="built_in">Math</span>.floor(j / stride)] += src[i][j];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (swap) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; tn; ++i) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> j = i + <span class="number">1</span>; j &lt; tn; ++j) &#123;</span><br><span class="line">        <span class="keyword">const</span> tmp = arr[i][j];</span><br><span class="line">        arr[i][j] = arr[j][i];</span><br><span class="line">        arr[j][i] = tmp;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">freqToProb</span>(<span class="params">src</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> hsz = src ? src.length : <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (hsz === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// assert(hsz === src[0].length);</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> total = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; hsz; ++i) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; hsz; ++j) &#123;</span><br><span class="line">      total += src[i][j];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> pAB = zeros(hsz, hsz);</span><br><span class="line">  <span class="keyword">const</span> pA = zeros(hsz, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">const</span> pB = zeros(<span class="number">1</span>, hsz);</span><br><span class="line">  <span class="keyword">const</span> pmi = constantMatrix(hsz, hsz, <span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; hsz; ++i) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; hsz; ++j) &#123;</span><br><span class="line">      <span class="keyword">const</span> p = src[i][j] / total;</span><br><span class="line">      pAB[i][j] = p;</span><br><span class="line">      pA[i][<span class="number">0</span>] += p;</span><br><span class="line">      pB[<span class="number">0</span>][j] += p;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; hsz; ++i) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; hsz; ++j) &#123;</span><br><span class="line">      <span class="keyword">const</span> pj = pAB[i][j];</span><br><span class="line">      <span class="keyword">if</span> (pj &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        pmi[i][j] = <span class="number">-1</span> * <span class="built_in">Math</span>.log(pj / pA[i][<span class="number">0</span>] / pB[<span class="number">0</span>][j]) / <span class="built_in">Math</span>.log(pj);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; pAB, pA, pB, <span class="attr">cardinality</span>: total, pmi &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">flattenMatrix</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x.reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a.concat(b));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">quantile</span>(<span class="params">xx, qq</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> xs = flattenMatrix(xx).sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a - b);</span><br><span class="line">  <span class="keyword">return</span> (xs[<span class="built_in">Math</span>.floor(xs.length * qq)] + xs[<span class="built_in">Math</span>.ceil(xs.length * qq)]) / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">matrixFind</span>(<span class="params">xx, condition</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!xx || xx.length &lt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> nn = xx[<span class="number">0</span>].length;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> xf = flattenMatrix(xx)</span><br><span class="line">    .reduce(<span class="function">(<span class="params">a, b, i</span>) =&gt;</span> (condition(b, i) ? a.concat([[<span class="built_in">Math</span>.floor(i / nn), i % nn]]) : a),</span><br><span class="line">    []);</span><br><span class="line">  <span class="keyword">return</span> xf;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">matrixSubset</span>(<span class="params">mat, isRow, idx</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (isRow) &#123;</span><br><span class="line">    <span class="keyword">return</span> [mat[idx]]; <span class="comment">// return a "new" matrix that has only one row.</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> mat.map(<span class="function"><span class="params">row</span> =&gt;</span> [row[idx]]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">matrixChoose</span>(<span class="params">xx, idxs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> idxs.reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a.concat(xx[b[<span class="number">0</span>]][b[<span class="number">1</span>]]), []);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">topProb</span>(<span class="params">dd, qq</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> qval = quantile(dd.pAB, qq);</span><br><span class="line">  <span class="keyword">var</span> idxs = matrixFind(dd.pAB, d =&gt; d &gt; qval);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    pAB: matrixChoose(dd.pAB, idxs),</span><br><span class="line">    pmi: matrixChoose(dd.pmi, idxs),</span><br><span class="line">    idx: idxs,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">topPmi</span>(<span class="params">dd, qq</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> apmi = dd.pmi.map(<span class="function"><span class="params">row</span> =&gt;</span> row.map(<span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">Math</span>.abs(v)));</span><br><span class="line">  <span class="keyword">var</span> qval = quantile(apmi, qq);</span><br><span class="line">  <span class="keyword">var</span> idxs = matrixFind(apmi, d =&gt; d &gt; qval);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    pAB: matrixChoose(dd.pAB, idxs),</span><br><span class="line">    pmi: matrixChoose(dd.pmi, idxs),</span><br><span class="line">    idx: idxs,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Return the bins most probably linked to the given bin (above the \a qq quantile line of probability).</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">topBinProb</span>(<span class="params">dd, isA, bin, qq</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> subset = matrixSubset(dd.pAB, !isA, bin);</span><br><span class="line">  <span class="keyword">var</span> qval = quantile(subset, qq);</span><br><span class="line">  <span class="keyword">var</span> idxs = matrixFind(subset, d =&gt; d &gt; qval);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(</span><br><span class="line">    <span class="string">'binprob, isA:'</span>, isA,</span><br><span class="line">    <span class="string">' bin:'</span>, bin,</span><br><span class="line">    <span class="string">' idxs:'</span>, idxs,</span><br><span class="line">    <span class="string">' midx: '</span>, idxs.map(<span class="function"><span class="params">d</span> =&gt;</span> (!isA ? [bin, d[<span class="number">1</span>]] : [bin, d[<span class="number">0</span>]])),</span><br><span class="line">    <span class="string">' subset: '</span>, subset</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    pAB: matrixChoose(subset, idxs),</span><br><span class="line">    pmi: matrixChoose(matrixSubset(dd.pmi, !isA, bin), idxs),</span><br><span class="line">    idx: idxs.map(<span class="function"><span class="params">d</span> =&gt;</span> (!isA ? [bin, d[<span class="number">1</span>]] : [bin, d[<span class="number">0</span>]])),</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">topBinPmi</span>(<span class="params">dd, isA, bin, qq</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> subset = matrixSubset(dd.pmi, !isA, bin);</span><br><span class="line">  <span class="keyword">var</span> apmi = subset.map(<span class="function"><span class="params">row</span> =&gt;</span> row.map(<span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">Math</span>.abs(v)));</span><br><span class="line">  <span class="keyword">var</span> qval = quantile(apmi, qq);</span><br><span class="line">  <span class="keyword">var</span> idxs = matrixFind(apmi, d =&gt; d &gt; qval);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    pAB: matrixChoose(matrixSubset(dd.pAB, !isA, bin), idxs),</span><br><span class="line">    pmi: matrixChoose(subset, idxs),</span><br><span class="line">    idx: idxs.map(<span class="function"><span class="params">d</span> =&gt;</span> (!isA ? [bin, d[<span class="number">1</span>]] : [bin, d[<span class="number">0</span>]])),</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">calculateAngleAndRadius</span>(<span class="params">coords, containerDims</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> width = containerDims[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">const</span> height = containerDims[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">const</span> x = coords[<span class="number">0</span>] - (width / <span class="number">2</span>);</span><br><span class="line">  <span class="keyword">const</span> y = (height - coords[<span class="number">1</span>]) - (height / <span class="number">2</span>);</span><br><span class="line">  <span class="comment">// Need straight up in screen space to have angle 0, adjust atan2 args accordingly</span></span><br><span class="line">  <span class="keyword">let</span> arctangent = -<span class="built_in">Math</span>.atan2(-x, y);</span><br><span class="line">  <span class="keyword">if</span> (arctangent &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    arctangent = <span class="built_in">Math</span>.PI + (<span class="built_in">Math</span>.PI + arctangent);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> [arctangent, <span class="built_in">Math</span>.sqrt((x * x) + (y * y))];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  calculateAngleAndRadius,</span><br><span class="line">  constantMatrix,</span><br><span class="line">  downsample,</span><br><span class="line">  flattenMatrix,</span><br><span class="line">  freqToProb,</span><br><span class="line">  matrixChoose,</span><br><span class="line">  matrixFind,</span><br><span class="line">  matrixSubset,</span><br><span class="line">  quantile,</span><br><span class="line">  topBinPmi,</span><br><span class="line">  topBinProb,</span><br><span class="line">  topPmi,</span><br><span class="line">  topProb,</span><br><span class="line">  zeros,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

              </div>
              <footer class="article-footer">
                <time class="article-footer-updated" datetime="2018-01-04T16:45:40.804Z" itemprop="dateModified">Last updated: 2018-01-04</time>
                <a href="HistogramSelector.html" class="article-footer-prev" title="HistogramSelector"><i class="fa fa-chevron-left"></i><span>Prev</span></a><a href="ParallelCoordinates.html" class="article-footer-next" title="ParallelCoordinates"><span>Next</span><i class="fa fa-chevron-right"></i></a>
              </footer>
              
            </div>
          </div>
          <aside id="article-toc" role="navigation">
            <div id="article-toc-inner">
              <strong class="sidebar-title">Contents</strong>
              <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Source"><span class="toc-text">Source</span></a></li></ol>
              <a href="#" id="article-toc-top">Back to Top</a>
            </div>
          </aside>
        </div>
      </article>
      <aside id="sidebar" role="navigation">
  <div class="inner"><strong class="sidebar-title">Common/Core</strong><a href="CompositeClosureHelper.html" class="sidebar-link">CompositeClosureHelper</a><a href="LookupTable.html" class="sidebar-link">LookupTable</a><a href="LookupTableManager.html" class="sidebar-link">LookupTableManager</a><strong class="sidebar-title">Common/Misc</strong><a href="AnnotationBuilder.html" class="sidebar-link">AnnotationBuilder</a><a href="BusyMonitor.html" class="sidebar-link">BusyMonitor</a><a href="CanvasOffscreenBuffer.html" class="sidebar-link">CanvasOffscreenBuffer</a><a href="ColorPalettes.html" class="sidebar-link">ColorPalettes</a><a href="Convert.html" class="sidebar-link">Convert</a><a href="ConvertProxyProperty.html" class="sidebar-link">ConvertProxyProperty</a><a href="Debounce.html" class="sidebar-link">Debounce</a><a href="ImageExporter.html" class="sidebar-link">ImageExporter</a><a href="Loop.html" class="sidebar-link">Loop</a><a href="NumberFormatter.html" class="sidebar-link">NumberFormatter</a><a href="Observable.html" class="sidebar-link">Observable</a><a href="PingPong.html" class="sidebar-link">PingPong</a><a href="SelectionBuilder.html" class="sidebar-link">SelectionBuilder</a><a href="SizeHelper.html" class="sidebar-link">SizeHelper</a><a href="TimeProbeManager.html" class="sidebar-link">TimeProbeManager</a><a href="URLExtract.html" class="sidebar-link">URLExtract</a><a href="UUID.html" class="sidebar-link">UUID</a><a href="Validate.html" class="sidebar-link">Validate</a><a href="WebGl.html" class="sidebar-link">WebGl</a><strong class="sidebar-title">Common/State</strong><a href="EqualizerState.html" class="sidebar-link">EqualizerState</a><a href="PipelineState.html" class="sidebar-link">PipelineState</a><a href="ToggleState.html" class="sidebar-link">ToggleState</a><strong class="sidebar-title">Component/Native</strong><a href="BackgroundColor.html" class="sidebar-link">BackgroundColor</a><a href="Composite.html" class="sidebar-link">Composite</a><a href="Spacer.html" class="sidebar-link">Spacer</a><a href="ToggleControl.html" class="sidebar-link">ToggleControl</a><a href="Workbench.html" class="sidebar-link">Workbench</a><strong class="sidebar-title">Component/React</strong><a href="ComponentToReact.html" class="sidebar-link">ComponentToReact</a><a href="ReactAdapter.html" class="sidebar-link">ReactAdapter</a><a href="WorkbenchController.html" class="sidebar-link">WorkbenchController</a><strong class="sidebar-title">IO/Core</strong><a href="CSVReader.html" class="sidebar-link">CSVReader</a><a href="DataManager.html" class="sidebar-link">DataManager</a><a href="GeometryDataModel.html" class="sidebar-link">GeometryDataModel</a><a href="ProcessLauncher.html" class="sidebar-link">ProcessLauncher</a><a href="QueryDataModel.html" class="sidebar-link">QueryDataModel</a><a href="VTKGeometryDataModel.html" class="sidebar-link">VTKGeometryDataModel</a><a href="VTKImageDataModel.html" class="sidebar-link">VTKImageDataModel</a><a href="VTKSLICDataModel.html" class="sidebar-link">VTKSLICDataModel</a><strong class="sidebar-title">IO/Girder</strong><a href="CoreEndpoints.html" class="sidebar-link">CoreEndpoints</a><a href="GirderClientBuilder.html" class="sidebar-link">GirderClientBuilder</a><strong class="sidebar-title">IO/WebSocket</strong><a href="AutobahnConnection.html" class="sidebar-link">AutobahnConnection</a><a href="BinaryImageStream.html" class="sidebar-link">BinaryImageStream</a><a href="ParaViewWebClient.html" class="sidebar-link">ParaViewWebClient</a><a href="SmartConnect.html" class="sidebar-link">SmartConnect</a><a href="WslinkImageStream.html" class="sidebar-link">WslinkImageStream</a><strong class="sidebar-title">InfoViz/Core</strong><a href="AnnotationStoreProvider.html" class="sidebar-link">AnnotationStoreProvider</a><a href="D3MultiClick.html" class="sidebar-link">D3MultiClick</a><a href="FieldProvider.html" class="sidebar-link">FieldProvider</a><a href="Histogram1DProvider.html" class="sidebar-link">Histogram1DProvider</a><a href="Histogram2DProvider.html" class="sidebar-link">Histogram2DProvider</a><a href="HistogramBinHoverProvider.html" class="sidebar-link">HistogramBinHoverProvider</a><a href="LegendProvider.html" class="sidebar-link">LegendProvider</a><a href="MutualInformationProvider.html" class="sidebar-link">MutualInformationProvider</a><a href="PersistentStateProvider.html" class="sidebar-link">PersistentStateProvider</a><a href="ScoresProvider.html" class="sidebar-link">ScoresProvider</a><a href="SelectionProvider.html" class="sidebar-link">SelectionProvider</a><strong class="sidebar-title">InfoViz/Native</strong><a href="FieldSelector.html" class="sidebar-link">FieldSelector</a><a href="HistogramSelector.html" class="sidebar-link">HistogramSelector</a><a href="MutualInformationDiagram.html" class="sidebar-link current">MutualInformationDiagram</a><a href="ParallelCoordinates.html" class="sidebar-link">ParallelCoordinates</a><strong class="sidebar-title">Interaction/Core</strong><a href="MouseHandler.html" class="sidebar-link">MouseHandler</a><a href="VtkWebMouseListener.html" class="sidebar-link">VtkWebMouseListener</a><strong class="sidebar-title">NativeUI/Canvas</strong><a href="GaussianPieceWiseEditor.html" class="sidebar-link">GaussianPieceWiseEditor</a><a href="LinearPieceWiseEditor.html" class="sidebar-link">LinearPieceWiseEditor</a><a href="RemoteRenderer.html" class="sidebar-link">RemoteRenderer</a><strong class="sidebar-title">NativeUI/Renderers</strong><a href="NativeImageRenderer.html" class="sidebar-link">NativeImageRenderer</a><a href="RemoteRendererStatsTable.html" class="sidebar-link">RemoteRendererStatsTable</a><strong class="sidebar-title">React/CollapsibleControls</strong><a href="CollapsibleControlFactory.html" class="sidebar-link">CollapsibleControlFactory</a><a href="FloatImageControl.html" class="sidebar-link">FloatImageControl</a><a href="LightControl.html" class="sidebar-link">LightControl</a><a href="LookupTableManagerControl.html" class="sidebar-link">LookupTableManagerControl</a><a href="MultiViewControl.html" class="sidebar-link">MultiViewControl</a><a href="PixelOperatorControl.html" class="sidebar-link">PixelOperatorControl</a><a href="PlotlyChartControl.html" class="sidebar-link">PlotlyChartControl</a><a href="ProbeControl.html" class="sidebar-link">ProbeControl</a><a href="QueryDataModelControl.html" class="sidebar-link">QueryDataModelControl</a><a href="TimeFloatImageControl.html" class="sidebar-link">TimeFloatImageControl</a><a href="VolumeControl.html" class="sidebar-link">VolumeControl</a><strong class="sidebar-title">React/Containers</strong><a href="OverlayWindow.html" class="sidebar-link">OverlayWindow</a><strong class="sidebar-title">React/Properties</strong><a href="CellProperty.html" class="sidebar-link">CellProperty</a><a href="CheckboxProperty.html" class="sidebar-link">CheckboxProperty</a><a href="CollapsiblePropertyGroup.html" class="sidebar-link">CollapsiblePropertyGroup</a><a href="EnumProperty.html" class="sidebar-link">EnumProperty</a><a href="MapProperty.html" class="sidebar-link">MapProperty</a><a href="PropertyFactory.html" class="sidebar-link">PropertyFactory</a><a href="PropertyGroup.html" class="sidebar-link">PropertyGroup</a><a href="PropertyPanel.html" class="sidebar-link">PropertyPanel</a><a href="SliderProperty.html" class="sidebar-link">SliderProperty</a><strong class="sidebar-title">React/Renderers</strong><a href="GeometryRenderer.html" class="sidebar-link">GeometryRenderer</a><a href="ImageRenderer.html" class="sidebar-link">ImageRenderer</a><a href="MultiLayoutRenderer.html" class="sidebar-link">MultiLayoutRenderer</a><a href="PlotlyRenderer.html" class="sidebar-link">PlotlyRenderer</a><a href="VtkGeometryRenderer.html" class="sidebar-link">VtkGeometryRenderer</a><a href="VtkRenderer.html" class="sidebar-link">VtkRenderer</a><strong class="sidebar-title">React/ToggleTools</strong><a href="AnnotationEditor.html" class="sidebar-link">AnnotationEditor</a><a href="FieldSelector.html" class="sidebar-link">FieldSelector</a><a href="ParallelCoordinates.html" class="sidebar-link">ParallelCoordinates</a><a href="ScatterPlotControl.html" class="sidebar-link">ScatterPlotControl</a><a href="WorkbenchLayout.html" class="sidebar-link">WorkbenchLayout</a><strong class="sidebar-title">React/Viewers</strong><a href="AbstractViewerMenu.html" class="sidebar-link">AbstractViewerMenu</a><a href="ChartViewer.html" class="sidebar-link">ChartViewer</a><a href="GeometryViewer.html" class="sidebar-link">GeometryViewer</a><a href="ImageBuilderViewer.html" class="sidebar-link">ImageBuilderViewer</a><a href="LineChartViewer.html" class="sidebar-link">LineChartViewer</a><a href="MultiLayoutViewer.html" class="sidebar-link">MultiLayoutViewer</a><a href="Probe3DViewer.html" class="sidebar-link">Probe3DViewer</a><strong class="sidebar-title">React/Widgets</strong><a href="ActionListWidget.html" class="sidebar-link">ActionListWidget</a><a href="AnnotationEditorWidget.html" class="sidebar-link">AnnotationEditorWidget</a><a href="AnnotationStoreEditorWidget.html" class="sidebar-link">AnnotationStoreEditorWidget</a><a href="BusyFeedback.html" class="sidebar-link">BusyFeedback</a><a href="ButtonSelectorWidget.html" class="sidebar-link">ButtonSelectorWidget</a><a href="CollapsibleWidget.html" class="sidebar-link">CollapsibleWidget</a><a href="ColorByWidget.html" class="sidebar-link">ColorByWidget</a><a href="ColorMapEditorWidget.html" class="sidebar-link">ColorMapEditorWidget</a><a href="ColorPickerWidget.html" class="sidebar-link">ColorPickerWidget</a><a href="CompositePipelineWidget.html" class="sidebar-link">CompositePipelineWidget</a><a href="ContentEditableWidget.html" class="sidebar-link">ContentEditableWidget</a><a href="Coordinate2DWidget.html" class="sidebar-link">Coordinate2DWidget</a><a href="CountToolbar.html" class="sidebar-link">CountToolbar</a><a href="DoubleSliderWidget.html" class="sidebar-link">DoubleSliderWidget</a><a href="DropDownWidget.html" class="sidebar-link">DropDownWidget</a><a href="EqualizerWidget.html" class="sidebar-link">EqualizerWidget</a><a href="FileBrowserWidget.html" class="sidebar-link">FileBrowserWidget</a><a href="GitTreeWidget.html" class="sidebar-link">GitTreeWidget</a><a href="InlineSvgIconWidget.html" class="sidebar-link">InlineSvgIconWidget</a><a href="InlineToggleButtonWidget.html" class="sidebar-link">InlineToggleButtonWidget</a><a href="LayoutsWidget.html" class="sidebar-link">LayoutsWidget</a><a href="LookupTableWidget.html" class="sidebar-link">LookupTableWidget</a><a href="NumberInputWidget.html" class="sidebar-link">NumberInputWidget</a><a href="NumberSliderWidget.html" class="sidebar-link">NumberSliderWidget</a><a href="OverlayTitleBar.html" class="sidebar-link">OverlayTitleBar</a><a href="PieceWiseFunctionEditorWidget.html" class="sidebar-link">PieceWiseFunctionEditorWidget</a><a href="PieceWiseGaussianFunctionEditorWidget.html" class="sidebar-link">PieceWiseGaussianFunctionEditorWidget</a><a href="PresetListWidget.html" class="sidebar-link">PresetListWidget</a><a href="ProxyEditorWidget.html" class="sidebar-link">ProxyEditorWidget</a><a href="ProxyPropertyGroupWidget.html" class="sidebar-link">ProxyPropertyGroupWidget</a><a href="QueryDataModelWidget.html" class="sidebar-link">QueryDataModelWidget</a><a href="ResplendentWidget.html" class="sidebar-link">ResplendentWidget</a><a href="ScalarRangeWidget.html" class="sidebar-link">ScalarRangeWidget</a><a href="ScatterPlotCameraControl.html" class="sidebar-link">ScatterPlotCameraControl</a><a href="ScatterPlotControl.html" class="sidebar-link">ScatterPlotControl</a><a href="SelectionEditorWidget.html" class="sidebar-link">SelectionEditorWidget</a><a href="SvgIconWidget.html" class="sidebar-link">SvgIconWidget</a><a href="TextInputWidget.html" class="sidebar-link">TextInputWidget</a><a href="ToggleIconButtonWidget.html" class="sidebar-link">ToggleIconButtonWidget</a><a href="TogglePanelWidget.html" class="sidebar-link">TogglePanelWidget</a><strong class="sidebar-title">Rendering/Chart</strong><a href="CDFChartBuilder.html" class="sidebar-link">CDFChartBuilder</a><a href="Histogram2DPlotlyChartBuilder.html" class="sidebar-link">Histogram2DPlotlyChartBuilder</a><a href="PlotlyChartBuilder.html" class="sidebar-link">PlotlyChartBuilder</a><strong class="sidebar-title">Rendering/Geometry</strong><a href="ThreeGeometryBuilder.html" class="sidebar-link">ThreeGeometryBuilder</a><a href="VTKGeometryBuilder.html" class="sidebar-link">VTKGeometryBuilder</a><a href="VTKVolumeBuilder.html" class="sidebar-link">VTKVolumeBuilder</a><strong class="sidebar-title">Rendering/Image</strong><a href="AbstractImageBuilder.html" class="sidebar-link">AbstractImageBuilder</a><a href="BinaryDataProberImageBuilder.html" class="sidebar-link">BinaryDataProberImageBuilder</a><a href="CompositeImageBuilder.html" class="sidebar-link">CompositeImageBuilder</a><a href="DataProberImageBuilder.html" class="sidebar-link">DataProberImageBuilder</a><a href="DepthCompositeImageBuilder.html" class="sidebar-link">DepthCompositeImageBuilder</a><a href="DepthImageBuilder.html" class="sidebar-link">DepthImageBuilder</a><a href="FloatDataImageBuilder.html" class="sidebar-link">FloatDataImageBuilder</a><a href="FloatTimeDataImageBuilder.html" class="sidebar-link">FloatTimeDataImageBuilder</a><a href="Histogram2DImageBuilder.html" class="sidebar-link">Histogram2DImageBuilder</a><a href="MagicLensImageBuilder.html" class="sidebar-link">MagicLensImageBuilder</a><a href="MultiColorBySortedCompositeImageBuilder.html" class="sidebar-link">MultiColorBySortedCompositeImageBuilder</a><a href="PixelOperatorImageBuilder.html" class="sidebar-link">PixelOperatorImageBuilder</a><a href="QueryDataModelImageBuilder.html" class="sidebar-link">QueryDataModelImageBuilder</a><a href="SortedCompositeImageBuilder.html" class="sidebar-link">SortedCompositeImageBuilder</a><strong class="sidebar-title">Rendering/Painter</strong><a href="LineChartPainter.html" class="sidebar-link">LineChartPainter</a></div>
</aside>
    </div>
  </div>
</div>

    <footer id="footer" class="wrapper">
  <div class="inner">
    <div id="footer-copyright">
      &copy; 2018 <a href="http://www.kitware.com" target="_blank">Kitware Inc.</a>
    </div>
    <div id="footer-links">
      <a href="https://github.com/kitware/paraviewweb" class="footer-link" target="_blank"><i class="fa fa-github-alt"></i></a>
    </div>
  </div>
</footer>

  </div>
  <div id="mobile-nav-dimmer"></div>
  <nav id="mobile-nav">
  <div id="mobile-nav-inner">
    <ul id="mobile-nav-list">
      <a href="/paraviewweb/docs/" class="mobile-nav-link">Docs</a><a href="/paraviewweb/api/" class="mobile-nav-link">API</a><a href="/paraviewweb/examples/" class="mobile-nav-link">Examples</a><a href="/paraviewweb/applications/" class="mobile-nav-link">Applications</a>
      <li class="mobile-nav-item">
        <a href="https://github.com/kitware/paraviewweb" class="mobile-nav-link" rel="external" target="_blank">GitHub</a>
      </li>
    </ul>
    
      <strong class="mobile-nav-title">Common/Core</strong><a href="CompositeClosureHelper.html" class="mobile-nav-link">CompositeClosureHelper</a><a href="LookupTable.html" class="mobile-nav-link">LookupTable</a><a href="LookupTableManager.html" class="mobile-nav-link">LookupTableManager</a><strong class="mobile-nav-title">Common/Misc</strong><a href="AnnotationBuilder.html" class="mobile-nav-link">AnnotationBuilder</a><a href="BusyMonitor.html" class="mobile-nav-link">BusyMonitor</a><a href="CanvasOffscreenBuffer.html" class="mobile-nav-link">CanvasOffscreenBuffer</a><a href="ColorPalettes.html" class="mobile-nav-link">ColorPalettes</a><a href="Convert.html" class="mobile-nav-link">Convert</a><a href="ConvertProxyProperty.html" class="mobile-nav-link">ConvertProxyProperty</a><a href="Debounce.html" class="mobile-nav-link">Debounce</a><a href="ImageExporter.html" class="mobile-nav-link">ImageExporter</a><a href="Loop.html" class="mobile-nav-link">Loop</a><a href="NumberFormatter.html" class="mobile-nav-link">NumberFormatter</a><a href="Observable.html" class="mobile-nav-link">Observable</a><a href="PingPong.html" class="mobile-nav-link">PingPong</a><a href="SelectionBuilder.html" class="mobile-nav-link">SelectionBuilder</a><a href="SizeHelper.html" class="mobile-nav-link">SizeHelper</a><a href="TimeProbeManager.html" class="mobile-nav-link">TimeProbeManager</a><a href="URLExtract.html" class="mobile-nav-link">URLExtract</a><a href="UUID.html" class="mobile-nav-link">UUID</a><a href="Validate.html" class="mobile-nav-link">Validate</a><a href="WebGl.html" class="mobile-nav-link">WebGl</a><strong class="mobile-nav-title">Common/State</strong><a href="EqualizerState.html" class="mobile-nav-link">EqualizerState</a><a href="PipelineState.html" class="mobile-nav-link">PipelineState</a><a href="ToggleState.html" class="mobile-nav-link">ToggleState</a><strong class="mobile-nav-title">Component/Native</strong><a href="BackgroundColor.html" class="mobile-nav-link">BackgroundColor</a><a href="Composite.html" class="mobile-nav-link">Composite</a><a href="Spacer.html" class="mobile-nav-link">Spacer</a><a href="ToggleControl.html" class="mobile-nav-link">ToggleControl</a><a href="Workbench.html" class="mobile-nav-link">Workbench</a><strong class="mobile-nav-title">Component/React</strong><a href="ComponentToReact.html" class="mobile-nav-link">ComponentToReact</a><a href="ReactAdapter.html" class="mobile-nav-link">ReactAdapter</a><a href="WorkbenchController.html" class="mobile-nav-link">WorkbenchController</a><strong class="mobile-nav-title">IO/Core</strong><a href="CSVReader.html" class="mobile-nav-link">CSVReader</a><a href="DataManager.html" class="mobile-nav-link">DataManager</a><a href="GeometryDataModel.html" class="mobile-nav-link">GeometryDataModel</a><a href="ProcessLauncher.html" class="mobile-nav-link">ProcessLauncher</a><a href="QueryDataModel.html" class="mobile-nav-link">QueryDataModel</a><a href="VTKGeometryDataModel.html" class="mobile-nav-link">VTKGeometryDataModel</a><a href="VTKImageDataModel.html" class="mobile-nav-link">VTKImageDataModel</a><a href="VTKSLICDataModel.html" class="mobile-nav-link">VTKSLICDataModel</a><strong class="mobile-nav-title">IO/Girder</strong><a href="CoreEndpoints.html" class="mobile-nav-link">CoreEndpoints</a><a href="GirderClientBuilder.html" class="mobile-nav-link">GirderClientBuilder</a><strong class="mobile-nav-title">IO/WebSocket</strong><a href="AutobahnConnection.html" class="mobile-nav-link">AutobahnConnection</a><a href="BinaryImageStream.html" class="mobile-nav-link">BinaryImageStream</a><a href="ParaViewWebClient.html" class="mobile-nav-link">ParaViewWebClient</a><a href="SmartConnect.html" class="mobile-nav-link">SmartConnect</a><a href="WslinkImageStream.html" class="mobile-nav-link">WslinkImageStream</a><strong class="mobile-nav-title">InfoViz/Core</strong><a href="AnnotationStoreProvider.html" class="mobile-nav-link">AnnotationStoreProvider</a><a href="D3MultiClick.html" class="mobile-nav-link">D3MultiClick</a><a href="FieldProvider.html" class="mobile-nav-link">FieldProvider</a><a href="Histogram1DProvider.html" class="mobile-nav-link">Histogram1DProvider</a><a href="Histogram2DProvider.html" class="mobile-nav-link">Histogram2DProvider</a><a href="HistogramBinHoverProvider.html" class="mobile-nav-link">HistogramBinHoverProvider</a><a href="LegendProvider.html" class="mobile-nav-link">LegendProvider</a><a href="MutualInformationProvider.html" class="mobile-nav-link">MutualInformationProvider</a><a href="PersistentStateProvider.html" class="mobile-nav-link">PersistentStateProvider</a><a href="ScoresProvider.html" class="mobile-nav-link">ScoresProvider</a><a href="SelectionProvider.html" class="mobile-nav-link">SelectionProvider</a><strong class="mobile-nav-title">InfoViz/Native</strong><a href="FieldSelector.html" class="mobile-nav-link">FieldSelector</a><a href="HistogramSelector.html" class="mobile-nav-link">HistogramSelector</a><a href="MutualInformationDiagram.html" class="mobile-nav-link current">MutualInformationDiagram</a><a href="ParallelCoordinates.html" class="mobile-nav-link">ParallelCoordinates</a><strong class="mobile-nav-title">Interaction/Core</strong><a href="MouseHandler.html" class="mobile-nav-link">MouseHandler</a><a href="VtkWebMouseListener.html" class="mobile-nav-link">VtkWebMouseListener</a><strong class="mobile-nav-title">NativeUI/Canvas</strong><a href="GaussianPieceWiseEditor.html" class="mobile-nav-link">GaussianPieceWiseEditor</a><a href="LinearPieceWiseEditor.html" class="mobile-nav-link">LinearPieceWiseEditor</a><a href="RemoteRenderer.html" class="mobile-nav-link">RemoteRenderer</a><strong class="mobile-nav-title">NativeUI/Renderers</strong><a href="NativeImageRenderer.html" class="mobile-nav-link">NativeImageRenderer</a><a href="RemoteRendererStatsTable.html" class="mobile-nav-link">RemoteRendererStatsTable</a><strong class="mobile-nav-title">React/CollapsibleControls</strong><a href="CollapsibleControlFactory.html" class="mobile-nav-link">CollapsibleControlFactory</a><a href="FloatImageControl.html" class="mobile-nav-link">FloatImageControl</a><a href="LightControl.html" class="mobile-nav-link">LightControl</a><a href="LookupTableManagerControl.html" class="mobile-nav-link">LookupTableManagerControl</a><a href="MultiViewControl.html" class="mobile-nav-link">MultiViewControl</a><a href="PixelOperatorControl.html" class="mobile-nav-link">PixelOperatorControl</a><a href="PlotlyChartControl.html" class="mobile-nav-link">PlotlyChartControl</a><a href="ProbeControl.html" class="mobile-nav-link">ProbeControl</a><a href="QueryDataModelControl.html" class="mobile-nav-link">QueryDataModelControl</a><a href="TimeFloatImageControl.html" class="mobile-nav-link">TimeFloatImageControl</a><a href="VolumeControl.html" class="mobile-nav-link">VolumeControl</a><strong class="mobile-nav-title">React/Containers</strong><a href="OverlayWindow.html" class="mobile-nav-link">OverlayWindow</a><strong class="mobile-nav-title">React/Properties</strong><a href="CellProperty.html" class="mobile-nav-link">CellProperty</a><a href="CheckboxProperty.html" class="mobile-nav-link">CheckboxProperty</a><a href="CollapsiblePropertyGroup.html" class="mobile-nav-link">CollapsiblePropertyGroup</a><a href="EnumProperty.html" class="mobile-nav-link">EnumProperty</a><a href="MapProperty.html" class="mobile-nav-link">MapProperty</a><a href="PropertyFactory.html" class="mobile-nav-link">PropertyFactory</a><a href="PropertyGroup.html" class="mobile-nav-link">PropertyGroup</a><a href="PropertyPanel.html" class="mobile-nav-link">PropertyPanel</a><a href="SliderProperty.html" class="mobile-nav-link">SliderProperty</a><strong class="mobile-nav-title">React/Renderers</strong><a href="GeometryRenderer.html" class="mobile-nav-link">GeometryRenderer</a><a href="ImageRenderer.html" class="mobile-nav-link">ImageRenderer</a><a href="MultiLayoutRenderer.html" class="mobile-nav-link">MultiLayoutRenderer</a><a href="PlotlyRenderer.html" class="mobile-nav-link">PlotlyRenderer</a><a href="VtkGeometryRenderer.html" class="mobile-nav-link">VtkGeometryRenderer</a><a href="VtkRenderer.html" class="mobile-nav-link">VtkRenderer</a><strong class="mobile-nav-title">React/ToggleTools</strong><a href="AnnotationEditor.html" class="mobile-nav-link">AnnotationEditor</a><a href="FieldSelector.html" class="mobile-nav-link">FieldSelector</a><a href="ParallelCoordinates.html" class="mobile-nav-link">ParallelCoordinates</a><a href="ScatterPlotControl.html" class="mobile-nav-link">ScatterPlotControl</a><a href="WorkbenchLayout.html" class="mobile-nav-link">WorkbenchLayout</a><strong class="mobile-nav-title">React/Viewers</strong><a href="AbstractViewerMenu.html" class="mobile-nav-link">AbstractViewerMenu</a><a href="ChartViewer.html" class="mobile-nav-link">ChartViewer</a><a href="GeometryViewer.html" class="mobile-nav-link">GeometryViewer</a><a href="ImageBuilderViewer.html" class="mobile-nav-link">ImageBuilderViewer</a><a href="LineChartViewer.html" class="mobile-nav-link">LineChartViewer</a><a href="MultiLayoutViewer.html" class="mobile-nav-link">MultiLayoutViewer</a><a href="Probe3DViewer.html" class="mobile-nav-link">Probe3DViewer</a><strong class="mobile-nav-title">React/Widgets</strong><a href="ActionListWidget.html" class="mobile-nav-link">ActionListWidget</a><a href="AnnotationEditorWidget.html" class="mobile-nav-link">AnnotationEditorWidget</a><a href="AnnotationStoreEditorWidget.html" class="mobile-nav-link">AnnotationStoreEditorWidget</a><a href="BusyFeedback.html" class="mobile-nav-link">BusyFeedback</a><a href="ButtonSelectorWidget.html" class="mobile-nav-link">ButtonSelectorWidget</a><a href="CollapsibleWidget.html" class="mobile-nav-link">CollapsibleWidget</a><a href="ColorByWidget.html" class="mobile-nav-link">ColorByWidget</a><a href="ColorMapEditorWidget.html" class="mobile-nav-link">ColorMapEditorWidget</a><a href="ColorPickerWidget.html" class="mobile-nav-link">ColorPickerWidget</a><a href="CompositePipelineWidget.html" class="mobile-nav-link">CompositePipelineWidget</a><a href="ContentEditableWidget.html" class="mobile-nav-link">ContentEditableWidget</a><a href="Coordinate2DWidget.html" class="mobile-nav-link">Coordinate2DWidget</a><a href="CountToolbar.html" class="mobile-nav-link">CountToolbar</a><a href="DoubleSliderWidget.html" class="mobile-nav-link">DoubleSliderWidget</a><a href="DropDownWidget.html" class="mobile-nav-link">DropDownWidget</a><a href="EqualizerWidget.html" class="mobile-nav-link">EqualizerWidget</a><a href="FileBrowserWidget.html" class="mobile-nav-link">FileBrowserWidget</a><a href="GitTreeWidget.html" class="mobile-nav-link">GitTreeWidget</a><a href="InlineSvgIconWidget.html" class="mobile-nav-link">InlineSvgIconWidget</a><a href="InlineToggleButtonWidget.html" class="mobile-nav-link">InlineToggleButtonWidget</a><a href="LayoutsWidget.html" class="mobile-nav-link">LayoutsWidget</a><a href="LookupTableWidget.html" class="mobile-nav-link">LookupTableWidget</a><a href="NumberInputWidget.html" class="mobile-nav-link">NumberInputWidget</a><a href="NumberSliderWidget.html" class="mobile-nav-link">NumberSliderWidget</a><a href="OverlayTitleBar.html" class="mobile-nav-link">OverlayTitleBar</a><a href="PieceWiseFunctionEditorWidget.html" class="mobile-nav-link">PieceWiseFunctionEditorWidget</a><a href="PieceWiseGaussianFunctionEditorWidget.html" class="mobile-nav-link">PieceWiseGaussianFunctionEditorWidget</a><a href="PresetListWidget.html" class="mobile-nav-link">PresetListWidget</a><a href="ProxyEditorWidget.html" class="mobile-nav-link">ProxyEditorWidget</a><a href="ProxyPropertyGroupWidget.html" class="mobile-nav-link">ProxyPropertyGroupWidget</a><a href="QueryDataModelWidget.html" class="mobile-nav-link">QueryDataModelWidget</a><a href="ResplendentWidget.html" class="mobile-nav-link">ResplendentWidget</a><a href="ScalarRangeWidget.html" class="mobile-nav-link">ScalarRangeWidget</a><a href="ScatterPlotCameraControl.html" class="mobile-nav-link">ScatterPlotCameraControl</a><a href="ScatterPlotControl.html" class="mobile-nav-link">ScatterPlotControl</a><a href="SelectionEditorWidget.html" class="mobile-nav-link">SelectionEditorWidget</a><a href="SvgIconWidget.html" class="mobile-nav-link">SvgIconWidget</a><a href="TextInputWidget.html" class="mobile-nav-link">TextInputWidget</a><a href="ToggleIconButtonWidget.html" class="mobile-nav-link">ToggleIconButtonWidget</a><a href="TogglePanelWidget.html" class="mobile-nav-link">TogglePanelWidget</a><strong class="mobile-nav-title">Rendering/Chart</strong><a href="CDFChartBuilder.html" class="mobile-nav-link">CDFChartBuilder</a><a href="Histogram2DPlotlyChartBuilder.html" class="mobile-nav-link">Histogram2DPlotlyChartBuilder</a><a href="PlotlyChartBuilder.html" class="mobile-nav-link">PlotlyChartBuilder</a><strong class="mobile-nav-title">Rendering/Geometry</strong><a href="ThreeGeometryBuilder.html" class="mobile-nav-link">ThreeGeometryBuilder</a><a href="VTKGeometryBuilder.html" class="mobile-nav-link">VTKGeometryBuilder</a><a href="VTKVolumeBuilder.html" class="mobile-nav-link">VTKVolumeBuilder</a><strong class="mobile-nav-title">Rendering/Image</strong><a href="AbstractImageBuilder.html" class="mobile-nav-link">AbstractImageBuilder</a><a href="BinaryDataProberImageBuilder.html" class="mobile-nav-link">BinaryDataProberImageBuilder</a><a href="CompositeImageBuilder.html" class="mobile-nav-link">CompositeImageBuilder</a><a href="DataProberImageBuilder.html" class="mobile-nav-link">DataProberImageBuilder</a><a href="DepthCompositeImageBuilder.html" class="mobile-nav-link">DepthCompositeImageBuilder</a><a href="DepthImageBuilder.html" class="mobile-nav-link">DepthImageBuilder</a><a href="FloatDataImageBuilder.html" class="mobile-nav-link">FloatDataImageBuilder</a><a href="FloatTimeDataImageBuilder.html" class="mobile-nav-link">FloatTimeDataImageBuilder</a><a href="Histogram2DImageBuilder.html" class="mobile-nav-link">Histogram2DImageBuilder</a><a href="MagicLensImageBuilder.html" class="mobile-nav-link">MagicLensImageBuilder</a><a href="MultiColorBySortedCompositeImageBuilder.html" class="mobile-nav-link">MultiColorBySortedCompositeImageBuilder</a><a href="PixelOperatorImageBuilder.html" class="mobile-nav-link">PixelOperatorImageBuilder</a><a href="QueryDataModelImageBuilder.html" class="mobile-nav-link">QueryDataModelImageBuilder</a><a href="SortedCompositeImageBuilder.html" class="mobile-nav-link">SortedCompositeImageBuilder</a><strong class="mobile-nav-title">Rendering/Painter</strong><a href="LineChartPainter.html" class="mobile-nav-link">LineChartPainter</a>
    
  </div>
  <div id="mobile-lang-select-wrap">
    <span id="mobile-lang-select-label"><i class="fa fa-globe"></i><span>English</span></span>
    <select id="mobile-lang-select" data-canonical="api/MutualInformationDiagram.html">
      
        <option value="en" selected>English</option>
      
    </select>
  </div>
</nav>
  <!-- Scripts -->
<!-- build:js build/js/main.js -->
<script src="/paraviewweb/js/lang_select.js"></script>
<script src="/paraviewweb/js/toc.js"></script>
<script src="/paraviewweb/js/mobile_nav.js"></script>
<!-- endbuild -->
<script src="https://cdn.jsdelivr.net/retinajs/1.3.0/retina.min.js" async></script>



</body>
</html>